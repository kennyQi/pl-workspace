<#assign contextPath=springMacroRequestContext.getContextPath() />
<#import "/public/frame/default.html" as dk> 
<@dk.head "- 修改管理员信息">
</@dk.head>
<@dk.defaultFrame "" "admin" "admin" "" "default" "adminBack" "admin" >
<!-- .main-centent Start-->
<div id="myApp" class="main add-app-content">		

<!--start: .add-app-content -->
<div class="add-app-box">
	<form target="_self" id="adminForm" action="${contextPath}/admin/updateAdmin" method="post">
		<input type="hidden" name="id" value="${admin.id!''}" />
		<table class="add-app-table">
			<tbody>
				<tr>
					<th class="rowhead"><span class="star"> * </span> 端口号：</th>
					<td><input type="text" class="text" value="${admin.dkUser.dkcode}" id="dkUser.dkcode" name="dkUser.dkcode" maxlength="10"></td>
				</tr>							
				<tr>
					<th class="rowhead"><span class="star"> * </span> 用户名：</th>
					<td><input type="text" class="text" value="${admin.name}" id="name" name="name" maxlength="20"></td>
				</tr>
				<tr>
					<th class="rowhead"><span class="star"> * </span> 邮箱：</th>
					<td><input type="text" class="text" value="${admin.dkUser.email}" id="dkUser.email" name="dkUser.email" maxlength="60"></td>
				</tr>												
				<tr>
					<th class="rowhead"><span class="star"> </span>角色：</th>
					<td>                        
                         <#list adminRoleList as ar>
                         <p>
                         	<input type="checkbox" name="checkboxs" id="checkboxs"  value="${ar.id!''}">   
                         	<#list admin.adminRoleSet as adminRole>
                         		<#if ar.id==adminRole.id>
                         		 <@dk.end>
                         		   <script src="${staticPath}/js/jquery.min.js" type="text/javascript"></script> 
                         		   <script type="text/javascript">
                         				$(document).ready(function(){
						        		$("[type='checkbox'][name='checkboxs']").each(function(){
							        		if(${adminRole.id}==$(this).val()){
							        			$(this).attr('checked',true);						        		
							        		}                          						
                         					});
                         				});                           				
                         			</script>
                         			</@dk.end>
                         		</#if>    				
                         	</#list>
                         ${ar.name!''}
						</p>
                       </#list>                        					
					</td>
				</tr>															 							
			</tbody>
		</table>		
		<div class="app-info-submit">
			<span><input id="buttons" class="btn-blue fwb" type="submit" value="保存"/></span>
			<span><input id="buttons" class="btn-blue fwb" type="button" onclick="returnTo();" value="返回"/></span>			
		</div>					
	</form>
</div>
<!--end: add-app-content -->
</div>
	
</@dk.defaultFrame>
<@dk.end>
<script src="${staticPath}/js/jquery-validation-1.9.0/jquery.validate.js" type="text/javascript"></script>
<script src="${staticPath}/js/jquery-validation-1.9.0/additional-methods.js" type="text/javascript"></script>
<script src="${staticPath}/js/jquery-validation-1.9.0/lib/jquery.metadata.js" type="text/javascript"></script>
<script type="text/javascript">
function returnTo() {
	window.location ="${contextPath}/admin/list";			
}
$(document).ready(function(){
	$("#adminForm").validate({
		rules: {
			//dkcode:{
				//required: true,
				//uniqueAdmin: true
			//},			
			name:{
				required: true
			}//,
			//email:{
			//	required: true
			//}
		},
		messages: {
			//dkcode:{
			//	required: "请填写端口号",
			//	uniqueAdmin: "填写的端口号已存在"
			//},			
			name:{
				required: "请填写用户名"
			}//,
			//email:{
			//	required: "请填写邮箱"
			//}		
		},
         errorPlacement: function(error,element){
         $('<br />').appendTo(element.parent());
         error.appendTo(element.parent());
        }
	});
	
	jQuery.validator.addMethod("uniqueAdmin", function(value, element){	
		var result;
		jQuery.ajax({
			type: "post",
			url: "${contextPath}/admin/existAdmin",
			cache:false,
			dataType:"json",
			data:{
				"dkcode":value
			},			
			success:function(data){
				result=data;
			}
		});				
		if(result=="false"){
			return false;
		}
		return true;
	});	
});
</script>
</@dk.end>