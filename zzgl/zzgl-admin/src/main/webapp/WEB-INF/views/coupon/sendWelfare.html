<#assign contextPath=springMacroRequestContext.getContextPath() />
<div class="pageContent">
	<form method="post" id="checkForm"   action="${contextPath}/couponActivity/sendWelfare" class="pageForm required-validate" onsubmit="return validateCallback(this, dialogAjaxDone)">
		<input type="hidden" name="id" value="${id}">
		<div class="pageFormContent" layoutH="58">
			<div class="unit" >
				导入EXCEL&nbsp;&nbsp;&nbsp;<input id="file123" type="file" name="file" size="60" onchange="fileUpload(this);"/>
					<p style="color: red;">目前只能支持后缀名为.xls的文件</p>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						
			
			</div>
			 <div class="unit" >
				EXCEL样章&nbsp;&nbsp;&nbsp;<input type="button" value="下载" class="download"/>	
			 </div>
			<div class="unit" >
				<textarea id="tels" name="tels" cols="70" rows="9" class="required" readonly="readonly"></textarea>
			</div>
		</div>
		<div class="formBar">
			<ul>
				
				<li><div class="button">
						<div class="buttonContent">
							<button type="submit" >发放</button>
						</div>
					</div>
				</li>
			</ul>
		</div>
	
	</form>
</div>

<script type="text/javascript">
	var uploadPath = '${contextPath}/couponActivity/sendWelfare/upload';	//文件上传地址
	/** 文件上传按钮单击事件 */
	function fileUpload(evt){
		var temp = $(evt);
		//获取后缀，并校验
		var vall = temp.val();
		var fileName = vall.substr(vall.lastIndexOf("\\")+1);
		var ext = vall.substr(vall.lastIndexOf(".")+1);
		if(!(ext && /^(xls)$/.test(ext.toLowerCase()))){
    		alertMsg.warn("暂不支持xls以外的文件！");
			return false;
    	}
		//发起请求
		$.ajaxFileUpload({
			url : uploadPath,
	       	secureuri : false,
	       	fileElementId : temp.attr("id"),
	       	dataType : "json",
	      	success: function (da,status) {
	      		if(da.msg=="success"){
	      			alertMsg.info("用户导入成功");
	      			$('#tels').val(da.tels);
	      		}else{
	      			if(da.detial==""){
	      				alertMsg.warn("手机号码载入出错，请检查excel版本及excel是否是按照模板来编写");
	      			}else{
	      				alertMsg.warn(da.detial);
	      			}
	      			
	      		}
	        },
	        error: function (data, status, e) {
	        	alertMsg.warn("文件上传失败，请稍后重试！");
	        	
	        }
	    });
	}
	
	
		
		
	//给下载添加事件
	$(".download").on("click",function(){
		
		location.href = "${contextPath}/couponActivity/sendWelfare/download";
	});
	
	
		
</script>
