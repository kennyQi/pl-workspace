<#assign contextPath=springMacroRequestContext.getContextPath() />
<#import "/public/frame/default.html" as frame /> 
<@frame.head "中智票量-会员中心">

<#if (((user.baseInfo.type?c)!0)==1)>
	<link href="${(contextPath)!}/resources/css/personal/personal_home.css" rel="stylesheet" />
	<link href="${(contextPath)!}/resources/css/personal/personal_allOrder.css" rel="stylesheet" />
<#elseif (((user.baseInfo.type?c)!0)==2)>
	<link href="${(contextPath)!}/resources/css/company/company_home.css" rel="stylesheet" />
	<link href="${(contextPath)!}/resources/css/company/company_allOrder.css" rel="stylesheet" />	
</#if>

<script src="${(contextPath)!}/resources/js/company/laydate/laydate.js" language="javascript"></script>
<script>
(function(){   //调用日期插件
 ;!function(){								
laydate.skin('dahong');							
      laydate({
         elem: '#demo'
      });							
   }();
 })();
</script>

</@frame.head>


<@frame.main "default" 1>
<div class="g_bd disb yahei">
	<!-- 个人中心顶部 -->
	<@frame.top ></@frame.top>
	
	<div class="g_cont disb ov">
		<@frame.nav "订单管理" 1></@frame.nav>
		<!--右侧呈现页-->
		<div class="m_cont ov fl">
			<div class="ri">
                <span class="rih1 yahei order_p onc"><a href="${(contextPath)!}/company/orderManage?sel=1">机票订单</a><i></i></span>
               <!--  <span class="rih1 yahei order_p "><a href="${(contextPath)!}/company/orderManage?sel=2">景点订单</a><i></i></span> -->
                <span class="rih1 yahei order_p"><a href="${(contextPath)!}/company/orderManage?sel=3">旅游订单</a><i></i></span>
                <!-- <span class="rih1 yahei order_p "><a href="${(contextPath)!}/company/orderManage?sel=4">酒店订单</a><i></i></span> -->
                <div class="navsbox"></div>
               
                <!--有订单-->
                <div class="yesOrder">
                <form action="${(contextPath)!}/company/orderManage?sel=1" name="jpQueryForm" id="jpQueryForm" class="jpQueryForm" method="post">
				<input type="hidden"  name="J_status" value="${(J_status)!}" />
                <input type="hidden" class="pageNum" name="page" value="${(jPagination.pageNo?c)!1}">
                <input type="hidden" name="pageSize" value="${(jPagination.pageSize?c)!5}">
                    <!--搜索框-->
                    <div class="orderBox">
                    <ul class="order">
                            <li>
                            <span class="selti h3">订单编号：</span>
                            <input id="J_orderNum" name="J_orderNum" type="text" class="border slor optionValue input_p" value="${(hslJPOrderQO.orderNO)!}">
                            <span></span>
                            </li>
                            <li style="width:370px; line-height:30px;">
                            	<span class="selti h3">下单时间：</span>
                            	<span class="numTextRight">
                            		<input id="cstart" name="J_beginTime" class="border changeTime input_p" onClick="laydate()" value="${(hslJPOrderQO.beginDateTime)!}">
                            	</span>
                            <i style=" margin:0 5px; float:left;">-</i>
                            <span class="numTextRight">
                            	<input id="cend" name="J_endTime" class="border changeTime input_p" onClick="laydate()" value="${(hslJPOrderQO.endDateTime)!}">
                            </span>
                            </li>
                            <li>
                            	<span class="selti h3">下单人：</span>
                            	<input id="J_bookMan" name="J_bookMan" type="text" class="border sl optionValue input_p" value="${(hslJPOrderQO.loginName)!}">
                            	 <span></span>
                            </li>
                            <li>
                            <span class="selti h3">订单状态：</span>
                            <span class="dd companySelect"><span class="optionValue" style="line-height:30px;" id="optionValue">请选择</span></span>
                            
                            <ul class="selectNav" for="optionValue"  forName="J_status">
								
								<li class="l" value="">请选择</li>
                                
                                <#list jpStatusList as stat >
									<li class="l" value="${stat.key}">${stat.value}</li> 
								</#list>
                                
                            </ul>
                            </li>
                                
                            <li style="width:350px;">
                            <span class="selti h3">乘机人：</span>
                            <input id="J_Passenger" name="J_Passenger" type="text" class="border sl optionValue input_p" value="${(hslJPOrderQO.actName)!}">
                            <span></span>
                            <a  id="sendJp" href="#" class="cx">查询</a></li>      
										
                        </ul>
                        
                    </div>

					<#if jpOrderList??&&((jpOrderList?size)>0)>
                    <!--搜索结果-->
                    <div class="tableBox">
                   	 
						 <#list jpOrderList as jpOrder>
	                    	<#if (jpOrder_index>4)><#break></#if>
							 <table cellspacing="0" cellpadding=0  class="tables">
		                        <tr class="tableTop">
		                        	<td class="order">订单号</td>
		                        	<td class="voyage">航程</td>
		                        	<td class="people">乘机人</td>
		                        	<td class="bank">票号</td>
		                        	<td class="status">订单状态</td>
		                        	<td class="policy">退费政策</td>
		                        	<td class="money">订单金额</td>
		                        	<td class="place">下单人</td>
		                        	<td class="operation">操作</td>
		                        </tr>
		                        <tr>
			                        <td class="order"><a href="${(contextPath)!}/company/orderManage/airplane?id=${(jpOrder.id)!}">${(jpOrder.orderNO)!}</a></td>
			                        <#if jpOrder.flightBaseInfo??>
			                        <td class="voyage"><i class="places"><i>${(jpOrder.flightBaseInfo.orgCity)!}</i><i class="fly"></i><i>${(jpOrder.flightBaseInfo.dstCity)!}</i></i><b class="flight">${(jpOrder.flightBaseInfo.airCompanyName)!}</b><b class="times">${(jpOrder.flightBaseInfo.startTime)?string("yyyy-MM-dd HH:mm")}</b></td>
			                       </#if>
			                        <td class="people">
			                        	<#list (jpOrder.passengers)!null as passengers>
											${(passengers.passengerName)!} <#if passengers_has_next> </br> </#if>
										</#list>
									</td>
			                        <td class="bank">
			                        <#list (jpOrder.passengers)!null as passengers>
											${(passengers.airId)!} <#if passengers_has_next> </br> </#if>
										</#list>
									</td>	
			                        <td class="status noTicket">
			                        ${(jpStatusMap[(''+jpOrder.status?c+jpOrder.payStatus?c)!])!}</td>
			                        <td class="policy"><a content="">暂无政策</a></td>
			                        <td class="money"><b>${(jpOrder.flightPriceInfo.payAmount)?c}</b></td>
			                        <td class="place"><i style="margin-top:15px;">${(user.authInfo.loginName)!}</i><br/><i>${(jpOrder.createTime?datetime)!}</i></td>
			                        <td class="operation operation_cont">
			                        
			                        	<a class="blue" href="${(contextPath)!}/company/orderManage/airplane?id=${(jpOrder.id)!}">查看详细</a>
			                        	<#if (((jpOrder.status?c)!0)==WAIT && (((jpOrder.payStatus?c)!0)==NOPAY))>
										<a class="blue" href="${(contextPath)!}/jp/toPayOrderInfo?dealerOrderCode=${(jpOrder.orderNO)!}">点击支付</a>
										</#if>
												
			                        </td>
		                        </tr>
		                    </table>		
									
						</#list>
                   
                    	<!--分页导航-->
	                   <div class="m_pageNav listPageStyle">
	                   <div id="page" class="m_nums"></div>
	                   </div>
	                   <!--分页导航-->
                </div>
               <!--有订单-->
               <#else>
               </div>
              <!--搜索无结果-->
              </form>
             <!--没有数据-->
               
             <div class="noOrder" >
                 <span class="noIcon" style="background:url(${(contextPath)!}/resources/images/company/ic_script.png) 0 -427px;"></span>
                 <span class="in">您目前还没有机票订单哦~</span>
             </div>
            </#if>
             <!--没有数据-->
            </div>
		</div>
		<!--右侧呈现页-->
	</div>
 </div>
<@frame.end "default"> </@frame.end> 
</@frame.main>

<script src="${(contextPath)!}/resources/js/pageUtil/pageUtilforA.js"></script>
<script type="text/javascript">
	
	$(function() {
		
	    // 添加机票分页控件
	    pageCreate(${(((jPagination.totalCount-1)/5+1)?int)!1},"jpQueryForm")
		
		//初始化机票状态
		$('[forName="J_status"]').find("li[value='"+$("[name='J_status']").val()+"']").click();
		
	});

	//搜索框校验
	$("#J_orderNum").blur(function() {
		var reg = /^[a-zA-Z0-9]{0,100}$/
		var bianhao = $("#J_orderNum").val();
		if (reg.test(bianhao)) {
			$(this).next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确编号",$(this).offset().top-20,$(this).offset().left+$(this).width());
		}
	});

	$("#J_PNR").blur(function() {
		var reg = /^[a-zA-Z0-9]{0,6}$/
		var bianhao = $("#J_PNR").val();
		if (reg.test(bianhao)) {
			$(this).next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确pnr",$(this).offset().top-20,$(this).offset().left+$(this).width());
		}
	});

	$("#J_bookMan").add("#J_Passenger").blur(function() {
		
		var reg = /^[a-zA-Z0-9\_\u4e00-\u9fa5]{0,100}$/
		var xiadan = $(this).val();
		if (reg.test(xiadan)) {
			$(this).next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确的文字",$(this).offset().top-20,$(this).offset().left+$(this).width());
		}
	});
	

	//给查询按钮添加监听
	$('#sendJp').on("click", function() {
		
		var bianhao = $("#J_orderNum").val();
		var xiadan = $("#J_bookMan").val();
		var pnr = $("#J_PNR").val();
		var chengji = $("#J_Passenger").val();
		var number = /^[a-zA-Z0-9]{0,100}$/;
		var reg = /^[a-zA-Z0-9\_\u4e00-\u9fa5]{0,100}$/;
		var pnrT = /^[a-zA-Z0-9]{0,6}$/;
		var cn = /^[\u4e00-\u9fa5]{0,100}$/;
		//订单编号
		if (number.test(bianhao)) {
			$("#J_orderNum").next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确编号",$("#J_orderNum").offset().top-20,$("#J_orderNum").offset().left+$("#J_orderNum").width());
			return false;
		}
		//用户名
		if (reg.test(xiadan)) {
			$("#J_bookMan").next("span").html("");
			$(".m_errTips").remove();
		} else {
			//$("#J_bookMan").next("span").html("请输入正确的下单人");
			alertMsg("请输入正确的下单人",$("#J_bookMan").offset().top-20,$("#J_bookMan").offset().left+$("#J_bookMan").width());
			return false;
		}
		/* //pnr
		if (pnrT.test(pnr)) {
			$("#J_PNR").next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确pnr",$("#J_bookMan").offset().top-20,$("#J_bookMan").offset().left+$("#J_bookMan").width());
			return false;
		} */
		
		//乘客
		if (cn.test(chengji)) {
			$("#J_Passenger").next("span").html("");
			$(".m_errTips").remove();
		} else {
			alertMsg("请输入正确的乘机人",$("#J_Passenger").offset().top-20,$("#J_Passenger").offset().left+$("#J_Passenger").width());
			return false
		}
		
		//重置分页的信息
		//$('.J_pageNo').val(1);
		$('#jpQueryForm').submit();
	});

		
		
	</script>


