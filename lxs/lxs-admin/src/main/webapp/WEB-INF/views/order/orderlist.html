<#assign contextPath=springMacroRequestContext.getContextPath() />
<style type="text/css">
.searchContent td{text-align: left}
</style>
<div class="pageHeader">
	<form id="pagerForm" rel="pagerForm" onsubmit="return navTabSearch(this);"
		action="${contextPath}/lineOrder/lineOrderList" method="post">
		<input type="hidden" name="pageNum" value="${pagination.pageNo?c}" />
		<input type="hidden" name="numPerPage" value="${pagination.pageSize?c}" />
		<div class="searchBar">
			<table class="searchContent">
				<tr>
					<td style="text-align: left">
						订单号：
					</td>
					<td><input type="text" name="dealerOrderNo"  value="${lineOrderQO.dealerOrderNo}"></td>
					<td style="text-align: left">
						线路编号：
					</td>
					<td><input type="text" name="lineNumber"  value="${lineOrderQO.lineNumber}"></td>
					<td style="text-align: left">
						线路名称：
					</td>
					<td><input type="text" name="lineName"  value="${lineOrderQO.lineName}"></td>
					<td style="text-align: left">
						预订人：
					</td>
					<td><input type="text" name="booker"  value="${lineOrderQO.booker}"></td>
					<td>
						下单日期：
					</td>
					<td>
		       			<input id="beginDate" name="startTime" <#if lineOrderQO.startTime??> value="${lineOrderQO.startTime}"  </#if>   class="date" [dateFmt="yyyy-MM-dd"] readonly="readonly" />
		       			-<input id="endDate"  name="endTime" <#if lineOrderQO.endTime??> value="${lineOrderQO.endTime}"  </#if>   class="date" [dateFmt="yyyy-MM-dd"] readonly="readonly" />
		    		</td>
		    	</tr>
		    	<tr>
		    		<td>
		    			订单状态：
		    		</td>
		    		<td>
			    		<select name="orderStatus"><option value="">全部状态</option>
			    			<#list statusMap?keys as itemKey>
			    				<#if  lineOrderQO??&&lineOrderQO.orderStatus??>
			    					<#if itemKey?string == lineOrderQO.orderStatus>
			    						<option value="${itemKey}" selected="selected" >${statusMap[itemKey]}</option>
			    					<#else>
	                       				<option value="${itemKey}">${statusMap[itemKey]}</option>
	                       			</#if>
	                       		<#else>
	                       			<option value="${itemKey}">${statusMap[itemKey]}</option>
			    				</#if>
	                   		</#list>
	                   </select>
		    		</td>
		    		<td>
		    			支付状态：
		    		</td>
		    		<td>
			    		<select name="payStatus"><option value="">全部状态</option>
			    			<#list payStatusMap?keys as itemKey>
			    				<#if  lineOrderQO??&&lineOrderQO.payStatus??>
			    					<#if itemKey?string == lineOrderQO.payStatus>
			    						<option value="${itemKey}" selected="selected" >${payStatusMap[itemKey]}</option>
			    					<#else>
	                       				<option value="${itemKey}">${payStatusMap[itemKey]}</option>
	                       			</#if>
	                       		<#else>
	                       			<option value="${itemKey}">${payStatusMap[itemKey]}</option>
			    				</#if>
	                   		</#list>
	                   </select>
		    		</td>
				</tr>
				<tr>
				</tr>
			</table>
			<div class="subBar">
				<ul>
					<li><div class="buttonActive">
							<div class="buttonContent">
								<button onclick="return checkQuery();" ><span>查询</span></button>
							</div>
						</div>
					</li>
				</ul>
			</div>
		</div>
	</form>
</div>
<div class="pageContent">
	<table class="table" width="100%" layoutH="210"  nowrapTD="false">
		<thead>
			<tr>
				<th width="150">经销商订单号</th>
				<th width="100">线路编号</th>
				<th width="150">线路名称</th>
				<th width="100">出发地</th> 
				<th colspan="5"  width="450">
				</th>
				<th width="100">订单总金额</th>
				<th width="100">定金金额</th>
				<th width="100">下单时间</th>
				<th width="100">联系方式</th>
				<th width="100">操作</th>
			</tr>
		</thead>
		<tbody>
			<#list pagination.list as lineOrderDTO>				
				<tr height="80px">
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo??>
						${lineOrderDTO.baseInfo.dealerOrderNo}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.line?? && lineOrderDTO.lineSnapshot.line.baseInfo??>
						${lineOrderDTO.lineSnapshot.line.baseInfo.number}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.line?? && lineOrderDTO.lineSnapshot.line.baseInfo??>
							${lineOrderDTO.lineSnapshot.line.baseInfo.name}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.starting??>
                               ${lineOrderDTO.lineSnapshot.starting}    
		                </#if>
					</td>
					
					<td  colspan="5" >
						<table width="100%" height="100%" border="1">
						<tr>
							<th width="40px">价格</th>
			 				<th width="40px">姓名</th>
							<th width="80px">身份证件号</th>
							<th width="140px">订单状态</th>
							<th width="140px">支付状态</th>
						</tr>
						<#if lineOrderDTO.travelers??>
							<#list lineOrderDTO.travelers as traveler>
								<tr>
									<td>
									<#if traveler?? && traveler.singleSalePrice??>
										${traveler.singleSalePrice}
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.name??>
										${traveler.name}
									</#if>
									</td>
									<td style="width:120px;">
									<#if traveler?? && traveler.idNo??>
										${traveler.idNo}
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.lineOrderStatus??>
										<#if statusMap??>
						                   <#list statusMap?keys as itemKey>
						                       <#if itemKey == traveler.lineOrderStatus.orderStatus?c>
						                       		${statusMap[itemKey]}
						                       </#if>
						                   </#list>
						                </#if>
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.lineOrderStatus??>
										<#if payStatusMap??>
						                   <#list payStatusMap?keys as itemKey>
						                       <#if itemKey == traveler.lineOrderStatus.payStatus?c>
						                       		${payStatusMap[itemKey]}
						                       </#if>
						                   </#list>
						                </#if>
									</#if>							
									</td>
								</tr>
							</#list>
						</#if>
						</table>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.salePrice??>
						${(lineOrderDTO.baseInfo.salePrice)?string('0.00')}
						</#if>					
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.bargainMoney??>
						${(lineOrderDTO.baseInfo.bargainMoney)?string('0.00')}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.createDate??>
						${(lineOrderDTO.baseInfo.createDate)?string("yyyy-MM-dd HH:mm:ss")}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.linkInfo??>
						${(lineOrderDTO.linkInfo.linkMobile)!''}
						</#if>
					</td>
					<td>
					<table style="width: 100%;height: 100%" border="">
					<tr style="height: 50%">
					<td style="width: 50%">
					<#list lineOrderDTO.orderStautes?split(",") as status>
						<#if status!="2004"&&status!="2003"&&status!="">
							<a target="dialog" href="${contextPath}/lineOrder/cancle?id=${lineOrderDTO.id}" width="400" height="250" style="color: blue"> 取消订单</a>
							<#break>
						</#if>
					</#list>
					</td>
					</tr>
					<tr style="height: 50%">
					<td style="width: 50%"><a target="dialog" href="${contextPath}/lineOrder/detail?id=${lineOrderDTO.id}" width="1000" height="800" style="color: blue">
								 订单详情
							</a></td>
					</tr>
					</table>
					</td>
			 </tr>
			</#list>
		</tbody>
	</table>
	
	<#include "/public/pagination/pagination.html">
</div>
<script type="text/javascript">
	//检查查询条件
	function checkQuery() {
		var beginDate = document.getElementById("beginDate").value;
		var endDate = document.getElementById("endDate").value;
		if (beginDate != "" && endDate != "") {
			if (beginDate > endDate) {
				alert("结束时间不能小于开始时间");
				return false;
			}
		}
	}
</script>