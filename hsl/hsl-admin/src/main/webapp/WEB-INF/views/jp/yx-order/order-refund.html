<#assign contextPath=springMacroRequestContext.getContextPath() />
<div class="pageContent">
	<form method="post" id="refundForm" action="${contextPath}/yxjp/order/refund-order" class="pageForm required-validate" onsubmit="return formSubmitCheck(this)">
		<input type="hidden" name="orderId" value="${(id)!}" />

		<div class="pageFormContent" layoutH="58">
			<div id="passangerDiv" style="display: none"></div>
			<div class="unit">
				<span>请选择需要退票的乘客：</span>
			</div>
			<div class="unit">
				<#if (canRefundPrs)??>
					<#list canRefundPrs as ps>
						<input type="checkbox" name="checkPerson" id="${(ps.id)!}">${(ps.baseInfo.name)!}
					</#list>

				</#if>
			</div>
			<div class="unit">
				<span>*申请类型</span>
			</div>
			<div class="unit">
				<select name="refundType" id="refundType" class="required" onchange="autoSetResion();" style="width:20%">
					<option value>请选择</option>
					<option value="1">当日作废</option>
					<option value="2">自愿退票</option>
					<option value="3">非自愿退票</option>
					<option value="4">差错退款</option>
					<option value="5">其他</option>
				</select>
			</div>

			<div class="unit">
				<span>*申请理由</span>
			</div>
			<div class="unit">
				<textarea name="refundMemo" class="required" style="width:50%;height:125px"></textarea>
			</div>

		</div>
		<div class="formBar">
			<ul>
				<li><div class="buttonActive"><div class="buttonContent"><button type="submit">确定</button></div></div></li>
				<li><div class="button"><div class="buttonContent"><button type="button" class="close">关闭</button></div></div></li>
			</ul>
		</div>
	</form>
</div>

<script type="text/javascript">
	function autoSetResion(){
		var tempReason = $("#actionType").find("option:selected").text();
		//alert("tempReason="+tempReason);
		$("#reason").val(tempReason);
	}

	function formSubmitCheck(that){
		try{
			var htm="";
			$("#refundForm").find("input[name='checkPerson']").each(function(){
				if(this.checked == true){
					var passengerId = $(this).attr("id");
					htm+="<input name='passengerIds' value='"+passengerId+"'>";
				}

			})
			if(htm==""){
				alertMsg.error("请选择需要退票的乘客");
				return false;
			}

			$("#refundForm #passangerDiv").html(htm);

			validateCallback(that, dialogAjaxDone);
		}catch(e){
			console.info(e);
		}
		return false;
	}
</script>