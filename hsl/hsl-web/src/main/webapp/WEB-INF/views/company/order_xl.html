<#assign contextPath=springMacroRequestContext.getContextPath() />
<#import "/public/frame/default.html" as frame /> 
<@frame.head "订单管理">

<#if (((user.baseInfo.type?c)!0)==1)>
	<link href="${(contextPath)!}/resources/css/personal/personal_home.css" rel="stylesheet" />
	<link href="${(contextPath)!}/resources/css/personal/personal_allOrderLine.css" rel="stylesheet" />
<#elseif (((user.baseInfo.type?c)!0)==2)>
	<link href="${(contextPath)!}/resources/css/company/company_home.css" rel="stylesheet" />
	<link href="${(contextPath)!}/resources/css/company/company_allOrderLine.css" rel="stylesheet" />
</#if>
<script src="${(contextPath)!}/resources/js/company/laydate/laydate.js" language="javascript"></script> 
<script src="${(contextPath)!}/resources/js/company/company_allOrderLine.js" language="javascript"></script> 
<script>
(function(){   //调用日期插件
 ;!function(){								
laydate.skin('dahong');							
      laydate({
         elem: '#demo'
      });							
   }();
 })();
</script>
</@frame.head>


<@frame.main "default" 1>
<div class="g_bd disb yahei">
	<!-- 个人中心顶部 -->
	<@frame.top ></@frame.top>
	
	<div class="g_cont disb ov">
		<@frame.nav "订单管理" 1></@frame.nav>
		<div class="m_cont ov fl">
        <!--右侧呈现页-->
            <div class="ri">
                <span class="rih1 yahei order_p"><a href="${(contextPath)!}/company/orderManage?sel=5">机票订单</a><i></i></span>
                <span class="rih1 yahei order_p "><a href="${(contextPath)!}/company/orderManage?sel=2">景点订单</a><i></i></span>
                <span class="rih1 yahei order_p onc"><a href="${(contextPath)!}/company/orderManage?sel=3">旅游订单</a><i></i></span>
                <#if hasOldJpOrder>
                    <span class="rih1 yahei order_p"><a href="${(contextPath)!}/company/orderManage?sel=1">机票订单(旧)</a><i></i></span>
                </#if>
                 <!-- <span class="rih1 yahei order_p "><a href="${(contextPath)!}/company/orderManage?sel=4">酒店订单</a><i></i></span> -->
                <div class="navsbox"></div>
                <!--有订单-->
                <div class="yesOrder">
                    <div class="orderBox">
                    <form action="${(contextPath)!}/company/orderManage?sel=3" name="lineOrderForm" id="lineOrderForm" class="lineOrderForm" method="post">
                    	<!-- 门票订单状态、支付状态  复选框隐藏域 -->
						<input type="hidden" name="L_orderStatus" id="L_orderStatus" value="${(L_orderStatus)!}"/>	
						<input type="hidden" name="L_payStatus" id="L_payStatus" value="${(L_payStatus)!}"/>	
			             <!-- 分页 -->
			            <input type="hidden" class="pageNum" name="page" value="${(lPagination.pageNo?c)!}">
                		<input type="hidden" name="pageSize" value="${(lPagination.pageSize?c)!}">	
								
                    	<ul class="order">
                            <li>
	                            <span class="selti h3">订单编号：</span>
	                            <input id="l_orderId" name="L_orderId" type="text" class="border slor optionValue input_p" value="${(lineOrderQO.dealerOrderNo)!}">
                            </li>
                             <li>
                            	<span class="selti h3">线路编号：</span>
                            	<input type="text" id="l_number" name="L_number" value="${(lineOrderQO.lineNumber)!}" class="border sl optionValue input_p"></li>
                            <li style="width:370px; line-height:30px;">
                            	<span class="selti h3">下单时间：</span>
                            	<span class="numTextRight">
                            		<input name="L_beginTime" type="text" id="lstart" value="${(lineOrderQO.startTime)!}"  class="border changeTime input_p" onClick="laydate()">
                            	</span>
                            	<i style=" margin:0 5px; float:left;">-</i>
                            	<span class="numTextRight">
                            		<input name="L_endTime" type="text" id="lend" value="${(lineOrderQO.endTime)!}" class="border changeTime input_p" onClick="laydate()">
                            	</span>
                            </li>
                            <li><span class="selti h3">订单状态：</span><span class="dd companySelect"><span class="optionValue" id="optionValue" style="line-height:30px;">请选择</span></span>
                            <ul class="selectNav" for="optionValue" forName="L_orderStatus">
                                <li class="l" value="">请选择</li>
                                <#list lineOrderStatusList as map >
									<li class="l" value="${map.key}" >${map.value}</li> 
								</#list>
                            </ul>
                            </li>
                            <li style="width:570px; margin-left:20px;"><span class="selti h3">支付状态：</span><span class="dd companySelect"><span id="optionValue1" class="optionValue" style="line-height:30px;">请选择</span></span>
                            <ul class="selectNav" for="optionValue1" forName="L_payStatus">
                                <li class="l" value="">请选择</li>
                            	<#list linePayStatusList as map >
									<li  class="l" value="${map.key}" >${map.value}</li> 
								</#list>
                            </ul>
                            <a id="sendLine" href="javascript:;" class="cx">查询</a></li>
                        </ul>
                      </form>
                </div>
                 <#if lineOrderList??&&((lineOrderList?size)>0)>
            	 
			            <span class="inf_box"></span>
			            <span class="qx_box"></span>
	                 <div class="tableBox">
	                  <#list (lineOrderList)!null as lineOrder> 
						<#if (jpOrder_index>4)><#break></#if>
            	
                    <ul class="tableUl" style="margin-bottom:0;">
                        <li class="topBox">
                        <span class="lineName">线路名称</span>
                        <span class="departureCity">出发城市</span>
                        <span class="touristInf">游客信息</span>
                        <span class="money">订单金额</span>
                        <span class="contact">联系人</span>
                        <span class="operation">操作</span></li>
                    </ul>
                   
                   
                    <ul class="tableUl">
                        <li class="pl">
                        <span class="orderInf">
                        	订单编号：
                        	<i>
                        	<a class="blue" id="toLineDetail" href="${(contextPath)!}/company/orderManage/lineOrderDetails?id=${(lineOrder.baseInfo.dealerOrderNo)!}">${(lineOrder.baseInfo.dealerOrderNo)!}</a>
							&nbsp;
							</i>
                        	下单时间：
                        	<i><b>${(lineOrder.baseInfo.createDate)!}</b></i></span>
                        <span class="lineName">
                            <div class="img">
                           		<#list (lineOrder.lineSnapshot.line.lineImageList)!null as headImage>
	                            	<#if headImage_index==0>
		                           		<img width="100%" height="100%" src="${image_host}${(headImage.urlMaps['default'])!''}">
		                           </#if>
		                        </#list>
                            </div>
                            <div class="line">
                                <i class="line_name iStyle">
                                <a href="${(contextPath)!}/line/detail?id=${(lineOrder.lineSnapshot.line.id)!}">${(lineOrder.lineSnapshot.lineName)!}</a>
                                </i>
                                <i class="line_no iStyle color8">线路编号：${(lineOrder.lineSnapshot.line.baseInfo.number)!}</i>
                            </div>
                        </span>
                        <span class="departureCity"><i class="iStyle">${(lineOrder.lineSnapshot.cityName)!}</i></span>
                        <span class="touristInf"><a class="iStyle seeTourist" href="javascript:;">查看游客信息</a></span>
                        <span class="inf_box" style="display:none;"><div class="inf_float"><span class="float_title floating_p yahei h3" style="width:540px;">游客信息<a href="javascript:;"></a></span><ul><li class="inf_top"><span class="inf_name">姓名</span><span class="inf_ID">身份证号</span><span class="inf_price">单价</span><span class="inf_state">订单状态</span><span class="inf_Pstate">支付状态</span></li>
	                       <#list lineOrder.travelerList as traveler>
								<li>
									<span class="inf_name">${traveler.name}</span>
									<span class="inf_ID">${traveler.idNo}</span>
									<span class="inf_price">${traveler.singleSalePrice}</span>
									<span class="inf_state">${(lineOrderStatusMap[(traveler.lineOrderStatus.orderStatus?c)])!}</span>
									<span class="inf_Pstate wait">${(linePayStatusMap[(traveler.lineOrderStatus.payStatus?c)])!}</span>
								</li>
							</#list>
	                         </ul></div></span>
                        <span class="money">
                            <i class="iStyle h2" style="margin-top:20px; font-weight:bold;">${(lineOrder.baseInfo.salePrice)!}</i>
                            <i class="iStyle">(订金:${(lineOrder.baseInfo.bargainMoney)!})元</i>
                          
                        </span>
                        <span class="contact">
                            <i class="iStyle " style="margin-top:20px;">${(lineOrder.linkInfo.linkName)!}</i>
                            <i class="iStyle">${(lineOrder.linkInfo.linkMobile)!}</i>
                        </span>
                        <span class="operation">
                        
                        	<!-- <a class="iStyle qxOrder" style="margin-top:20px;" href="javascript:;">取消订单</a>
                            <a class="iStyle " href="javascript:;">支付尾款</a>
                            <a class="iStyle " href="${(contextPath)!}/company/orderManage/lineOrderDetails?id=${(lineOrder.baseInfo.dealerOrderNo)!}">查看订单</a> -->
                            
                            <a class="iStyle qxOrder" style="margin-top:20px;" href="javascript:;">取消订单</a>
                        	<#if (((lineOrder.baseInfo.travelDate)?string("yyyy-MM-dd"))?date("yyyy-MM-dd"))gte(currentData?date("yyyy-MM-dd"))>
								<#list lineOrder.travelerList as traveler>
									<#if traveler.lineOrderStatus.orderStatus==2002&&traveler.lineOrderStatus.payStatus==2103>
										<a class="iStyle " href="${(contextPath)!}/line/payBalance?orderid=${(lineOrder.baseInfo.dealerOrderNo)!}&identification=2">支付尾款</a>
										<#break>
									<#elseif traveler.lineOrderStatus.payStatus==2101&&traveler.lineOrderStatus.orderStatus==2001>
										<a class="iStyle " href="${(contextPath)!}/line/payBalance?orderid=${(lineOrder.baseInfo.dealerOrderNo)!}&identification=1" >支付订金</a>
										<#break>
									</#if>
								</#list>
							</#if>
							<a class="iStyle " href="${(contextPath)!}/company/orderManage/lineOrderDetails?id=${(lineOrder.baseInfo.dealerOrderNo)!}" >查看订单</a>
                        </span>
                        </li>
                        
                    </ul>
                    </#list> 
                    
                   <!--分页导航-->
			                   <div class="m_pageNav listPageStyle">
			                   <div id="page" class="m_nums"></div>
			                   </div>
			                   <!--分页导航-->
                </div>
                <#else>
            </div>
          <!--有订单-->
         <!--没有订单-->
         <div class="noOrder">
             <span class="noIcon" style="background:url(${(contextPath)!}/resources/images/company/ic_script.png) 0 -543px;"></span>
             <span class="in">您目前还没有旅游订单哦~</span>
         </div>
         <!--没有订单-->
         </#if>
     </div>
     </div>
     
	 <!--右侧呈现页-->
	 </div>
	</div>
 </div>
<@frame.end "default"> </@frame.end> 
</@frame.main>

<script src="${(contextPath)!}/resources/js/pageUtil/pageUtilforA.js"></script>
<script type="text/javascript">
	
	$(function() {
		//分页初始化
		 pageCreate(${(((lPagination.totalCount-1)/5+1)?int)!1},"lineOrderForm");
		
		//线路订单状态和支付状态初始化
		$('[forName="L_orderStatus"]').find("li[value='"+$("[name='L_orderStatus']").val()+"']").click();
		$('[forName="L_payStatus"]').find("li[value='"+$("[name='L_payStatus']").val()+"']").click();
	});
	
	
	$("#sendLine").on("click", function() {
		//重置分页的信息
		$('.L_pageNo').val(1);
		$('#lineOrderForm').submit();
	});
	
</script>		