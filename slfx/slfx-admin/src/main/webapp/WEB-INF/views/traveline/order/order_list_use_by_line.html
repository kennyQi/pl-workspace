<#assign contextPath=springMacroRequestContext.getContextPath() />
<style type="text/css">
.searchContent td{text-align: left}
</style>
<div class="pageHeader">

</div>
<div class="pageContent">
	<!-- <div class="panelBar">
		<ul class="toolBar">
			 <li>
               <a width="700" height="800" rel="line" class="add" href="${contextPath}/traveline/line/toadd" target="dialog" maxable="false" resizable="false"><span>新增线路</span></a>
           </li>
		</ul>
	</div>
	 -->
	<table class="table" width="100%" layoutH="210"  nowrapTD="false">
		<thead>
			<tr>
				<th width="9%">经销商订单号</th>
				<th width="9%">订单号</th>
				<th width="9%">线路编号</th>
				<th width="9%">线路名称</th>
				<th width="9%">出发地</th> 
				<th colspan="5"  class="xianl_w20" width="10%">
				    <!-- <span>价格</span>
	 			  	<span>姓名</span>
					<span style="width:120px;display:inline-block;">身份证件号</span>
					<span>订单状态</span>
					<span>支付状态</span>  -->
				</th>
				<th width="9%">订单总金额</th>
				<th width="9%">定金金额</th>
				<th width="9%">下单时间</th>
				<th width="9%">联系方式</th>
				<th width="9%">操作</th>
			</tr>
		</thead>
		<tbody>
			<#list pagination.list as lineOrderDTO>				
				<tr height="80px">
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo??>
						${(lineOrderDTO.baseInfo.dealerOrderNo)!''}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO??>
						${(lineOrderDTO.id)!''}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.line??>
						${(lineOrderDTO.lineSnapshot.line.id)!''}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.line?? && lineOrderDTO.lineSnapshot.line.baseInfo??>
						${(lineOrderDTO.lineSnapshot.line.baseInfo.name)!''}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.lineSnapshot?? && lineOrderDTO.lineSnapshot.starting??>
						    <#list citylist as city>
		                        <#if city.id == lineOrderDTO.lineSnapshot.starting>
		                               ${city.name}    
		                        </#if>
		                    </#list>
		                </#if>
					</td>
					
					<td  colspan="5" >
						<table width="100%" height="100%" border="1">
						<tr>
							<th width="40">价格</th>
			 				<th width="40">姓名</th>
							<th width="80">身份证件号</th>
							<th width="140">订单状态</th>
							<th width="140">支付状态</th>
						</tr>
						<#if lineOrderDTO.travelers??>
							<#list lineOrderDTO.travelers as traveler>
								<tr>
									<td>
<!-- 									<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.adultUnitPrice??> -->
<!-- 										${(lineOrderDTO.baseInfo.adultUnitPrice)?string('0.00')} -->
<!-- 									</#if> -->
									<#if traveler?? && traveler.singleSalePrice??>
										${(traveler.singleSalePrice)!''}
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.name??>
										${(traveler.name)!''}
									</#if>
									</td>
									<td style="width:120px;">
									<#if traveler?? && traveler.idNo??>
										${(traveler.idNo)!''}
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.xlOrderStatus??>
										<#if statusMap??>
						                   <#list statusMap?keys as itemKey>
						                       <#if itemKey == traveler.xlOrderStatus.status?c>
						                       		${statusMap[itemKey]}
						                       </#if>
						                   </#list>
						                </#if>
									</#if>
									</td>
									<td>
									<#if traveler?? && traveler.xlOrderStatus??>
										<#if payStatusMap??>
						                   <#list payStatusMap?keys as itemKey>
						                       <#if itemKey == traveler.xlOrderStatus.payStatus?c>
						                       		${payStatusMap[itemKey]}
						                       </#if>
						                   </#list>
						                </#if>
									</#if>							
									</td>
								</tr>
							</#list>
						</#if>
						</table>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.salePrice??>
						${(lineOrderDTO.baseInfo.salePrice)?string('0.00')}
						</#if>					
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.bargainMoney??>
						${(lineOrderDTO.baseInfo.bargainMoney)?string('0.00')}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.baseInfo?? && lineOrderDTO.baseInfo.createDate??>
						${(lineOrderDTO.baseInfo.createDate)?string("yyyy-MM-dd HH:mm:ss")}
						</#if>
					</td>
					<td>
						<#if lineOrderDTO?? && lineOrderDTO.linkInfo??>
						${(lineOrderDTO.linkInfo.linkMobile)!''}
						</#if>
					</td>
					<td>
						<p>
							<a target="dialog" href="${contextPath}/traveline/order/detail?id=${lineOrderDTO.id!''}" width="1000" height="800" style="color: blue">
								 订单详情
							</a>
							&nbsp;&nbsp;
							<a target="dialog" rel="lineorderfile" href="${contextPath}/traveline/order/filelist?lineOrderID=${lineOrderDTO.id!''}" width="600" height="400" style="color: blue">
								查看文件
							</a>
						</p>
						<br/>
						<p>
							<a target="dialog" href="${contextPath}/traveline/order/tocancle?id=${lineOrderDTO.id!''}" width="400" height="200" style="color: blue">
								取消订单
							</a>
							&nbsp;&nbsp;
<!-- 							<a target="dialog" href="${contextPath}/traveline/order/toedit?id=${lineOrderDTO.id!''}" width="1000" height="800" style="color: blue"> -->
<!-- 								修改订单 -->
<!-- 							</a> -->
						</p>
						<br/>
						<p>
							<a target="dialog" href="${contextPath}/traveline/order/payinfo?lineOrderID=${lineOrderDTO.id!''}" width="800" height="400" style="color: blue">
								 查看支付信息
							</a>
							&nbsp;&nbsp;
							<a target="dialog" href="${contextPath}/traveline/order/tochange?id=${lineOrderDTO.id!''}" width="400" height="200" style="color: blue">
								更改订单状态
							</a>
						</p>
						<br/>
					</td>
			 </tr>
			</#list>
		</tbody>
	</table>
	
	<#include "/public/pagination/pagination.html">
</div>
<script type="text/javascript">
//当出发地下拉框选择“国内”时，联动出省市下拉框
$("#startingDepart").change(function(){
   $.post("${contextPath}/traveline/line/searchProvince",function(data){
			if (data.length > 0) {  
	            var layer = "<option value='-1'>--请选择省份--</option>";  
	            var initCity = "<option value='-1'>全部</option>";
	            $.each(data, function (idx, item) {  
	                layer += "<option value="+item.code +">"+ item.name + "</option>";  
	            });
	            
				$("#start_province").empty();
				$("#start_province").append(layer);
				$("#start_city").empty();
				$("#start_city").append(initCity);
				
				//展现省市下拉框
				$("#province").show();
				$("#starting").show();
	        }  
	},"json"); 
});

//当选择了指定的省份时，则该省份的城市列表初始化出来
 $("#start_province").change(function(){
	$.post("${contextPath}/traveline/line/searchCity",{'province':$("#start_province").val()},function(data){
		if (data.length > 0) {  
            var layer = "<option value='-1'>全部</option>";  
            $.each(data, function (idx, item) {  
                layer += "<option value="+item.code +">"+ item.name + "</option>";  
            });
            
			$("#start_city").empty();
			$("#start_city").append(layer);
        }  
	},"json");
}); 


//当线路类型下拉框选择“国内线”时，联动出省市下拉框
 $("#domesticLine").change(function(){
    $.post("${contextPath}/traveline/line/searchProvince",function(data){
 			if (data.length > 0) {  
 	            var layer = "<option value='-1'>--请选择省份--</option>";  
 	            var initCity = "<option value='-1'>全部</option>";
 	            $.each(data, function (idx, item) {  
 	                layer += "<option value="+item.code +">"+ item.name + "</option>";  
 	            });
 	            
 				$("#start_domestic_province").empty();
 				$("#start_domestic_province").append(layer);
 				$("#start_domestic_city").empty();
 				$("#start_domestic_city").append(initCity);
 				
 				//展现省市下拉框
 				$("#domestic_province").show();
 				$("#domestic_starting").show();
 	        }  
 	},"json"); 
 });

 //当选择了指定的省份时，则该省份的城市列表初始化出来
  $("#start_domestic_province").change(function(){
 	$.post("${contextPath}/traveline/line/searchCity",{'province':$("#start_domestic_province").val()},function(data){
 		if (data.length > 0) {  
             var layer = "<option value='-1'>全部</option>";  
             $.each(data, function (idx, item) {  
                 layer += "<option value="+item.code +">"+ item.name + "</option>";  
             });
             
 			$("#start_domestic_city").empty();
 			$("#start_domestic_city").append(layer);
         }  
 	},"json");
 }); 
 
//判断网站价格只能为数字
$("#beginPrice").bind("blur",function() {
	 var  reg=new  RegExp("[0-9]");
	 var  beginPrice = $("#beginPrice").val();//取得开始价格的值
	 if(!reg.test(beginPrice)){
		 alertMsg.error("您填写的网站价格有误，只能为数字！", beginPrice);
		 return false;
	 }
});
$("#endPrice").bind("blur",function() {
	 var  reg=new  RegExp("[0-9]");
	 var  endPrice = $("#endPrice").val();//取得开始价格的值
	 if(!reg.test(endPrice)){
		 alertMsg.error("您填写的网站价格有误，只能为数字！", endPrice);
		 return false;
	 }
});




var  startingProvinceID = $("#startingProvinceID").val();
var  startingCityID = $("#startingCityID").val();
var  startingDepart = $("#startingDepart").val();
var  domesticLine = $("#domesticLine").val();
//alert(startingProvinceID+":"+startingCityID+":"+startingDepart);
/*=========================出发地查询之后重新加载页面时会调用===============================*/
if(startingProvinceID != null && startingProvinceID != "" && startingDepart == 1){
	$.post("${contextPath}/traveline/line/searchProvince",function(data){
			if (data.length > 0) {  
	            var layer = "<option value='-1'>--请选择省份--</option>";  
	            var initCity = "<option value='-1'>全部</option>";
	            $.each(data, function (idx, item) {  
	                layer += "<option value="+item.code  + (item.code == startingProvinceID ? " selected=selected" : " ") + ">"+ item.name + "</option>";  
	            });
	            
	        	$("#start_province").empty();
				$("#start_province").append(layer);
				$("#start_city").empty();
				$("#start_city").append(initCity);
				
				//展现省市下拉框
				$("#province").show();
				$("#starting").show();
	        }  
	},"json"); 
}

if(startingCityID != null && startingCityID != "" && startingDepart == 1){
	$.post("${contextPath}/traveline/line/searchCity",{'province':startingProvinceID},function(data){
 		if (data.length > 0) {  
             var layer = "<option value='-1'>全部</option>";  
             $.each(data, function (idx, item) {  
            	 layer += "<option value="+item.code  + (item.code == startingCityID ? " selected=selected" : " ") + ">"+ item.name + "</option>";  
             });
             
             $("#start_city").empty();
 			 $("#start_city").append(layer);
         }  
     },"json");
}

//当线路类型下拉框选择“国内线”时，联动出省市下拉框,重新加载页面的时候
/*=========================线路类别查询之后重新加载页面时会调用===============================*/
if(startingProvinceID != null && startingProvinceID != "" && domesticLine == 1){
	$.post("${contextPath}/traveline/line/searchProvince",function(data){
			if (data.length > 0) {  
	            var layer = "<option value='-1'>--请选择省份--</option>";  
	            var initCity = "<option value='-1'>全部</option>";
	            $.each(data, function (idx, item) {  
	                layer += "<option value="+item.code  + (item.code == startingProvinceID ? " selected=selected": " ") + ">"+ item.name + "</option>";  
	            });
	            
	            $("#start_domestic_province").empty();
 				$("#start_domestic_province").append(layer);
 				$("#start_domestic_city").empty();
 				$("#start_domestic_city").append(initCity);
 				
 				//展现省市下拉框
 				$("#domestic_province").show();
 				$("#domestic_starting").show();
	        }  
	},"json"); 
}

if(startingCityID != null && startingCityID != "" && domesticLine == 1){
	//alert(startingCityID);
	$.post("${contextPath}/traveline/line/searchCity",{'province':startingProvinceID},function(data){
 		if (data.length > 0) {  
             var layer = "<option value='-1'>全部</option>";  
             $.each(data, function (idx, item) {  
            	 layer += "<option value="+item.code  + (item.code == startingCityID ? " selected=selected" : " ") + ">"+ item.name + "</option>";
             });
             
            $("#start_domestic_city").empty();
  			$("#start_domestic_city").append(layer);
         }  
 	},"json");
}

</script>
