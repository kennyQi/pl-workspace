<#assign contextPath=springMacroRequestContext.getContextPath() />
<link href="${contextPath}/resources/css/ajaxfileupload.css" rel="stylesheet" type="text/css" media="print" />
<script src="${contextPath}/resources/js/ajaxfileupload.js" type="text/javascript"></script>
<script type="text/javascript">

var a000="1";
$(document).ready(function() {
//	hideTemplate();



	
///	dbp(a(null,null,null));
});
function getPhotoSize(obj){
	var maxSize = 2000;//单位kb
	
    photoExt=obj.value.substr(obj.value.lastIndexOf(".")).toLowerCase();//获得文件后缀名
    if(photoExt!='.jpg' && photoExt!='.jpeg' && photoExt!='.bmp' && photoExt!='.png'){
        alert("请上传格式为jpg、jpeg、png、bmp的照片!");
        return false;
    }
    var fileSize = 0;
    var isIE = /msie/i.test(navigator.userAgent) && !window.opera;            
    if (isIE && !obj.files) {          
         var filePath = obj.value;            
         var fileSystem = new ActiveXObject("Scripting.FileSystemObject");   
         var file = fileSystem.GetFile (filePath);               
         fileSize = file.Size;         
    }else {  
         fileSize = obj.files[0].size;     
    } 
    fileSize=Math.round(fileSize/1024*100)/100; //单位为KB
    if(fileSize>=maxSize){
        alert("照片最大尺寸为"+maxSize+"KB，请重新上传!");
        return false;
    }
}



function submitMainForm(){
	$("#mainForm").submit();
}

function uploadImg(){
	$('#formFile').ajaxSubmit({
		                   success: function (html, status) {
		                        var result = html.replace("<pre>", "");
		                       result = result.replace("</pre>", "");
		                        $("#image").attr('src', result);
		                       alert(result);
		                    }
		               });
}

function productFileChg(obj) {
	var picSize = $(obj).parents(".pageContent").find(".uploaded img").size();
	
	if (picSize >= 10) {
		alertMsg.info("最多上传10图片");
		return;
	}
	$.ajaxFileUpload({
       url : contextPath + '/product/product/upload',
       secureuri : false,
       fileElementId : 'productImageFile',
       dataType : 'json',
      success: function (data, status) {
    	  	var result = data;
//    	  	$(".uploaded").append("<img src='" + result.imageUrl + "'alt='' width='100' height='100'/><button type='button' style='width:100px'>删除</button>");
    	  	$(".uploaded").append("<dd imageid='" +  result.imageId + "'><a target='_blank' href='" + result.imageUrl + "'><img src='" + result.imageUrl + "' alt='无图片' height='100px' width='100px'/></a></br><button type='button' style='width:100px' onclick='return deleteImage(this);'>删除</button></dd>");
    	  	//$(".u-upload :hidden[name=productImageId]").val(result.imageId);
    	  	$(".u-upload").append("<input type='hidden' name='productImageId' value='" + result.imageId + "' />");
        },
        error: function (data, status, e) {
            alertMsg.error("上传失败");
        }
    });
}

function fileChg(me) {
	
	$.ajaxFileUpload({
       url : '${contextPath}/test/upload',
       secureuri : false,
       fileElementId : 'brandPictureFile',
       dataType : 'json',
      success: function (data, status) {
    	  alert(data);
    	  	var result = data;
    	  	if("success" == result.status){
	       		$("#brandPictureId").val(result.imageId);
	       		$("#brandPictureName").val(result.imageName);
	       		$("#brandPictureImageSrc").attr("src",result.imageUrl);
    	  	}else if(result.status=="error"){
	    		   alertMsg.error(result.message);
    	  	}else{
	    		   alertMsg.error("未定义的操作！");
    	  	}
        },
        error: function (data, status, e) {
            alert("上传失败");
        }
    });
}
</script>
<h2 class="contentTitle">文件上传</h2>
<div class="pageContent">

	<div class="pageFormContent" layoutH="97">
		<form id="mainForm" action="${contextPath}/test/ret" method="post" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone)">

			<input type="text" name="name" required />

		</form>

		<!--  
			<input type="file" id="imgFile" name="upload" style="width:150px;" onchange="getPhotoSize(this)"/>
			<button type="submit">保存</button>
			-->


		<form id='formFile' name='formFile' method="post" action="${contextPath}/test/upload" enctype="multipart/form-data">
			<input type='file' id='fileUp' name='fileUp' />
			<div id='uploadLog'></div>
			<br /> <img width='100' src='' height='100' id='image' alt='缩略图' />
		</form>
		<a onclick="uploadImg()">sc</a> -----
		<dd class="upimg">
			<img id="brandPictureImageSrc" height="120px" width="120px" src="" alt="" />
			<div>
				<p>&nbsp;请上传JPG/PNG/GIF格式的LOGO图片，最大不超过2M，图片大小120×60px</p>
				<span class="u-upload">
					<button type="button" onclick="myEdit.clickFileInput(this);">上传图片</button> <input id="brandPictureFile" name="brandPictureFile" type="file" onchange="fileChg(this);" /> <input type="hidden"
					name="brandPictureId" id="brandPictureId" value="" /> <input type="hidden" name="brandPictureName" id="brandPictureName" value="" /> </span>
			</div>
		</dd>
	</div>
	<div class="formBar">
		<ul>
			<li><div class="buttonActive">
					<div class="buttonContent">
						<a onclick="submitMainForm()">保存</a>
					</div>
				</div></li>
			<li><div class="button">
					<div class="buttonContent">
						<button class="close" type="button">关闭</button>
					</div>
				</div></li>
		</ul>
	</div>
</div>