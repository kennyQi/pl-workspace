<#assign contextPath=springMacroRequestContext.getContextPath() />
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" name="viewport" />
<title>修改密码</title>
<link href="${contextPath}/resources/css/common.css" rel="stylesheet" />
<link href="${contextPath}/resources/css/global.css" rel="stylesheet" />
<link href="${contextPath}/resources/css/findPwd.css" rel="stylesheet" />
  <script src="${contextPath}/resources/js/libs/jquery-2.1.4.min.js" language="javascript"></script>
  <script type="text/javascript">
function summitForm1(){
	 $.post("changePwd",$("#form1").serialize(), function(data) {
 		if(data.success) {
 			alertMsg(data.message);
 			if(data.changepwd){
	 			setTimeout("document.getElementById('logout').click()",500);
 			}
 	}}, "json");
	 
	 
	//document.getElementById("form1").submit();
	//alertMsg('修改成功！')
}

function alertMsg(msg){
    var html=' <div class="alertMsg"> <span>'+msg+'</span> </div>';
    $(".alertMsg").remove();
    $("body").append(html);
    var that=$(".alertMsg");
    setTimeout(function(){
      that.remove();
    },2500);}
</script>

</head>

<body>
<a href="${contextPath}/logout" style="display: none;" id="logout"></a>
<div class="bg2_header">
  <header class="header box">
      <a href="javascript:history.back()" class="back_iconfont iconfont">&#xe606;</a>
      <h1>修改密码</h1>
  </header>
</div>
<section class="content_form">
  <form id="form1" action="" method="post" onsubmit="">
    <div class="input_wrap input_wrap_4">
      <dl>
        <dt>旧密码</dt>
        <dd>
          <input type="password"  id="oldpwd" name="password">
        </dd>
      </dl>
      <dl>
        <dt>新密码</dt>
        <dd>
          <input type="password" placeholder="6-20位的字母和数字" id="newpwd" name="newPassword">
        </dd>
      </dl>
      <dl>
        <dt>确认新密码</dt>
        <dd>
          <input type="password" placeholder="6-20位的字母和数字" id="newPwdAgain">
        </dd>
      </dl>
    </div>
    <div class="btn_wrap">
      <input type="submit" class="btn_submit" value="确定" onclick="">
    </div>
  </form>
</section>

<script>

  $(".btn_submit").click(function(e){
    e.preventDefault();
    var newpwd=$("#newpwd");
    var newPwdAgain=$("#newPwdAgain");
    var pattern=/[`~!@#$%^&*()_+<>?:"{},.\/;'[\]]/im;
    
    if(newpwd.val()==""){
      alertMsg("请填写新密码");
      newpwd.focus();
      return;
    }
    if(newPwdAgain.val()==""){
      alertMsg("请再次填写新密码");
      newPwdAgain.focus();
      return;
    }
    if(newPwdAgain.val()!=newpwd.val()){
        alertMsg("两次密码不一致请确认");
        newpwd.focus();
        newPwdAgain.val("");
        newpwd.val("");
        return;
      }
    
    var flag=true;
      var that=$("#newpwd");
      if(flag){
    
        if(that.val().length<6||that.val().length>20){
          alertMsg("请填写6-20位字母和数字组合");
          that.focus();
          flag=false;
        }
        if(pattern.test(that.val())){
          alertMsg("有非法字符`~!@#$%^&*(");
          that.focus();
          flag=false;
        }
      }
    if(!flag){
      return;
    }
    
    summitForm1()
  });
  function alertMsg(msg){
    var html=' <div class="alertMsg"> <span>'+msg+'</span> </div>';
    $(".alertMsg").remove();
    $("body").append(html);
    var that=$(".alertMsg");
    setTimeout(function(){
      that.remove();
    },2500);
  }
</script>
</body>
</html>
