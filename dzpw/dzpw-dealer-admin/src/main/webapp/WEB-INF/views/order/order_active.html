<#assign contextPath=springMacroRequestContext.getContextPath() />

<script type="text/javascript">

function checkTimeStr(){
	
	if($("#createBeginDateStr").val()!="" && $("#createEndDateStr").val()!=""){
		if($("#createBeginDateStr").val()>$("#createEndDateStr").val()){
			alert("下单开始时间不能大于下单结束时间!");
			return false
		}else{
			return true;
		}
	}else{
		return true;
	}
}

function initText(obj){
    var searchBar = $(obj).parents("form").find(".searchBar");
    searchBar.find("input").val("");
    searchBar.find("select").attr("value",'');
}

</script>


<div class="pageHeader">
	<form id="pagerForm" rel="pagerForm" onsubmit="return navTabSearch(this);" action="${contextPath}/order/activeList" method="get">
		<input type="hidden" name="pageNum" value="${pagination.pageNo?c}" />
		<input type="hidden" name="numPerPage" value="${pagination.pageSize?c}" />
		
		<div class="searchBar">
			<ul class="searchContent" style="overflow: inherit;">
			    <li style="width: 250px;">
					<label>订单编号：</label><input type="text" id="orderId" name="orderId" value="${orderId}" />
				</li>
				
			    <li style="width: 250px;">
					<label>票务编号：</label><input type="text" id="ticketId" name="ticketId" value="${ticketId}" />
				</li>
				
				<li style="width: 250px;">
					<label>票务类型：</label>
					<select name="ticketPolicyType" id="ticketPolicyType" style="max-width: 80px;">
							<option value="">全部</option>
							<option value="1" <#if 1 == ticketPolicyType>selected="selected"</#if> >单票订单</option>
							<option value="2" <#if 2 == ticketPolicyType>selected="selected"</#if> >联票订单</option>
					</select>
				</li>
				<li style="width: 250px;">
					<label>票务名称：</label><input type="text" id="ticketPolicyName" name="ticketPolicyName" value="${ticketPolicyName}" />
				</li>
				
				<li style="width: 250px;">
					<label>景区：</label><select name="scenicSpotId" id="scenicSpotId" style="max-width: 80px;">
							<option value="">全部</option>
							<#list scenicSpotList as spot>
							<option value="${spot.id}" <#if spot.id==scenicSpotId>selected="selected"</#if>>${spot.baseInfo.name}</option>
							</#list>
					</select>
				</li>
				<li style="width: 250px;">
					<label>预定人：</label><input type="text" id="linkMan" name="linkMan" value="${linkMan}" />
				</li>
				<li style="width: 500px;">
					<label>下单时间：</label>
					<input type="text" id="createBeginDateStr" name="createBeginDateStr" value="${createBeginDateStr}"	class="date" readonly="true"/>
					&nbsp;到&nbsp;
					<input type="text" id="createEndDateStr" name="createEndDateStr" value="${createEndDateStr}" class="date" readonly="true" />
				</li>
			</ul>
			
			<div class="subBar">
				<ul>
					<li><div class="buttonActive">
							<div class="buttonContent">
								<button type="submit"  onclick="return checkTimeStr()">查询</button>
							</div>
						</div>
						<div class="buttonActive">
							<div class="buttonContent">
								<button type="button" onclick="return initText(this)">重置</button>
							</div>
						</div>
					</li>
				</ul>
			</div>
			
		</div>
	</form>
</div>


<div class="pageContent">
  <div class="panelBar">
		<ul class="toolBar">
			<li>
				<a class="icon" href="${contextPath}/order/export" targetType="navTab" target="dwzExport"><span>导出EXCEL</span></a>
			</li>
			<li>
				<a width="520" height="200" class="add" href="${contextPath}/order/toImportActive" target="dialog" maxable="false" resizable="false"><span>导入激活</span></a>
			</li>
		</ul>
	</div>
    <#include "/public/pagination/pagination.html">
	<table class="table" width="100%" layoutH="170">
		<thead>
			<tr>
				<th width="145px;">订单编号</th>
				<th width="160px;">票务编号</th>
				<th width="230px;">票务名称</th>
				<th width="85px;">票务类型</th>
				<th width="150px;">景区</th>
				<th width="150px;">预定人</th>
				<th width="150px;">预定人手机号</th>
				<th width="150px;">下单时间</th>
				<th width="180px;">操作</th>
			</tr>
		</thead>
		<tbody>
		<#list pagination.list as singleTicket>
			<tr>
				<td>${singleTicket.groupTicket.ticketOrder.id}</td>
				<td>${singleTicket.groupTicket.ticketNo}</td>
				<#if singleTicket.groupTicket.ticketPolicySnapshot??>
				<td>${singleTicket.groupTicket.ticketPolicySnapshot.baseInfo.name!''}</td>
				<td><#if singleTicket.groupTicket.ticketPolicySnapshot.type==1>单票
				<#elseif singleTicket.groupTicket.ticketPolicySnapshot.type==2>联票
				</#if></td>
				<td>${singleTicket.ticketPolicySnapshot.scenicSpot.baseInfo.name}</td>
				<#else>
				<td></td><td></td><td></td><td></td>
				</#if>
				<td>${singleTicket.groupTicket.ticketOrder.baseInfo.linkMan}</td>
				<td>${singleTicket.groupTicket.ticketOrder.baseInfo.telephone}</td>
				<td>${singleTicket.groupTicket.ticketOrder.baseInfo.createDate?string("yyyy-MM-dd HH:mm:ss")}</td>
				<td>
					<a title="票务激活" target="dialog" href="${contextPath}/order/toActive?singleTicketId=${singleTicket.id}" height="195" width="330" style="color: blue">激活</a>
				</td>
			</tr>
		</#list>
		</tbody>
	</table>
	
</div>