var HG={statusCode:{ok:200,error:300,timeout:301},jsonEval:function(data){try{if($.type(data)=="string"){return eval("("+data+")")}else{return data}}catch(e){return{}}},ajaxError:function(C,B,A){HG.messager("<div>Http status: "+C.status+" "+C.statusText+"</div><div>ajaxOptions: "+B+"</div><div>thrownError: "+A+"</div><div>"+C.responseText+"</div>","error");HG.unblock()},ajaxDone:function(A){if(A.statusCode==HG.statusCode.error){if(A.message){HG.messager(A.message,"error")}}else{if(A.statusCode==HG.statusCode.timeout){HG.confirm("确认","登陆超时！请重新登陆！",function(){window.location=HG.getRootPath()+"/jq/login"})}else{if(A.message){HG.messager(A.message,"info")}}}},obj2str:function(C){var A=[];if(typeof C=="string"){return'"'+C.replace(/([\'\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"'}if(typeof C=="object"){if(!C.sort){for(var B in C){A.push(B+":"+HG.obj2str(C[B]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(C.toString)){A.push("toString:"+C.toString.toString())}A="{"+A.join()+"}"}else{for(var B=0;B<C.length;B++){A.push(HG.obj2str(C[B]))}A="["+A.join()+"]"}return A}return C.toString()},getForm:function(A){if(!A){return null}if(A.nodeName==="FORM"){return A}var B=A.parentElement;if(B.nodeName==="FORM"){return B}return HG.getForm(B)},arrayUnique:function(C){var B=[C[0]];for(var A=1;A<C.length;A++){var D=false;for(var E=0;E<B.length;E++){if(C[A]==B[E]){D=true;break}}if(!D){B.push(C[A])}}return B},fullProperty:function(A,C){var B=this;return A.replace(/\{([\w\-\.]+)\}/g,function(D,E){var F=B.property(C,E);return(F!==undefined&&F!==null)?F:""})},property:function(B,C,D){if(B){var A=C.indexOf(".");if(A>-1){var E=C.substring(0,A>-1?A:C.length);return HG.property(B[E],C.substring(A+1),D)}if(D){B[C]=D}return B[C]}},getRootPath:function(){var E=window.document.location.href;var A=window.document.location.pathname;var B=E.indexOf(A);var D=E.substring(0,B);var C=A.substring(0,A.substr(1).indexOf("/")+1);return(D+C)},triggerMinClickEvent:function(A){},getRandom:function(B){B=B||10;var E=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];var C="";for(var A=0;A<B;A++){var D=Math.ceil(Math.random()*35);C+=E[D]}return C},block:function(B,A){var A=$(A||"body");B=B||'<div class="loading"></div>';A.block({message:B,css:{width:"164px"}})},unblock:function(A){var A=$(A||"body");A.unblock()},confirm:function(B,D,A,C){B=B||"确认";D=D||"请确认";A=A||function(){};C=C||function(){};$.confirm({"title":B,"message":D,"buttons":{"确定":{"class":"blue","action":A},"取消":{"class":"gray","action":C}}})},messager:function(B,A){B=B||"操作成功！";A=A||"success";$.globalMessenger().post({message:B,showCloseButton:true,type:A})}};(function(A){Date.prototype.format=function(B){var C={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S":this.getMilliseconds()};if(/(y+)/.test(B)){B=B.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var D in C){if(new RegExp("("+D+")").test(B)){B=B.replace(RegExp.$1,(RegExp.$1.length==1)?(C[D]):(("00"+C[D]).substr((""+C[D]).length)))}}return B};A.extend(String.prototype,{isPositiveInteger:function(){return(new RegExp(/^[1-9]\d*$/).test(this))},isInteger:function(){return(new RegExp(/^\d+$/).test(this))},isNumber:function(B,C){return(new RegExp(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/).test(this))},trim:function(){return this.replace(/(^\s*)|(\s*$)|\r|\n/g,"")},startsWith:function(B){return this.indexOf(B)===0},endsWith:function(C){var B=this.length-C.length;return B>=0&&this.lastIndexOf(C)===B},replaceSuffix:function(B){return this.replace(/\[[0-9]+\]/,"["+B+"]").replace("#index#",B)},trans:function(){return this.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')},encodeTXT:function(){return(this).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll(" ","&nbsp;")},replaceAll:function(C,B){return this.replace(new RegExp(C,"gm"),B)},replaceTm:function(B){if(!B){return this}return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_]*})","g"),function(C){return B[C.replace(/[{}]+/g,"")]})},replaceTmById:function(C){var B=C||A(document);return this.replace(RegExp("({[A-Za-z_]+[A-Za-z0-9_]*})","g"),function(E){var D=B.find("#"+E.replace(/[{}]+/g,""));return D.val()?D.val():E})},isFinishedTm:function(){return !(new RegExp("{[A-Za-z_]+[A-Za-z0-9_]*}").test(this))},skipChar:function(B){if(!this||this.length===0){return""}if(this.charAt(0)===B){return this.substring(1).skipChar(B)}return this},isValidPwd:function(){return(new RegExp(/^([_]|[a-zA-Z0-9]){6,32}$/).test(this))},isValidMail:function(){return(new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/).test(this.trim()))},isSpaces:function(){for(var B=0;B<this.length;B+=1){var C=this.charAt(B);if(C!=" "&&C!="\n"&&C!="\t"&&C!="\r"){return false}}return true},isPhone:function(){return(new RegExp(/(^([0-9]{3,4}[-])?\d{3,8}(-\d{1,6})?$)|(^\([0-9]{3,4}\)\d{3,8}(\(\d{1,6}\))?$)|(^\d{3,8}$)/).test(this))},isUrl:function(){return(new RegExp(/^[a-zA-z]+:\/\/([a-zA-Z0-9\-\.]+)([-\w .\/?%&=:]*)$/).test(this))},isExternalUrl:function(){return this.isUrl()&&this.indexOf("://"+document.domain)==-1}});A._messengerDefaults={extraClasses:"messenger-fixed messenger-theme-future messenger-on-top messenger-on-right",maxMessages:3}})(jQuery);(function($){$.fn.extend({ajaxTodo:function(){return this.each(function(){var $this=$(this);$this.unbind("click").bind("click",function(event){var url=unescape($this.attr("href"));var title=$this.attr("title");if(title){HG.confirm("确认",title,function(r){ajaxTodo(url,$this.attr("callback"))})}else{ajaxTodo(url,$this.attr("callback"))}event.preventDefault()})})},selectedTodo:function(){function _getIds(selectedIds){var ids="";var $box=$.hgtab.getCurrent();$box.find("input:checked").filter("[name='"+selectedIds+"']").each(function(i){var val=$(this).val();ids+=i==0?val:","+val});return ids}return this.each(function(){var $this=$(this);var selectedIds=$this.attr("rel")||"ids";var postType=$this.attr("postType")||"map";$this.unbind("click").bind("click",function(){var targetType=$this.attr("targetType");var ids=_getIds(selectedIds,targetType);if(!ids){HG.messager("请选择信息！","info");return false}var _callback=$this.attr("callback")||(hgTabAjaxDone);if(!$.isFunction(_callback)){_callback=eval("("+_callback+")")}function _doPost(){$.ajax({type:"POST",url:$this.attr("href"),dataType:"json",cache:false,data:function(){if(postType=="map"){return $.map(ids.split(","),function(val,i){return{name:selectedIds,value:val}})}else{var _data={};_data[selectedIds]=ids;return _data}}(),success:_callback,error:HG.ajaxError})}var title=$this.attr("title");if(title){HG.confirm("确认",title,_doPost)}else{_doPost()}return false})})}})})(jQuery);(function($){if($.validator){$.validator.addMethod("alphanumeric",function(value,element){return this.optional(element)||/^\w+$/i.test(value)},"Letters, numbers or underscores only please");$.validator.addMethod("lettersonly",function(value,element){return this.optional(element)||/^[a-z]+$/i.test(value)},"Letters only please");$.validator.addMethod("phone",function(value,element){return this.optional(element)||/^[0-9 \(\)]{7,30}$/.test(value)},"Please specify a valid phone number");$.validator.addMethod("postcode",function(value,element){return this.optional(element)||/^[0-9 A-Za-z]{5,20}$/.test(value)},"Please specify a valid postcode");$.validator.addMethod("date",function(value,element){value=value.replace(/\s+/g,"");if(String.prototype.parseDate){var $input=$(element);var pattern=$input.attr("dateFmt")||"yyyy-MM-dd";return !$input.val()||$input.val().parseDate(pattern)}else{return this.optional(element)||value.match(/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/)}},"Please enter a valid date.");$.validator.addMethod("isSpec", function(value, element) {var reg=RegExp(/[(\ )(\`)(\~)(\!)(\@)(\#)(\$)(\%)(\^)(\&)(\*)(\+)(\=)(\|)(\{)(\})(\')(\:)(\;)(\')(',)(\[)(\])(\.)(\<)(\>)(\/)(\?)(\~)(\！)(\@)(\#)(\￥)(\%)(\…)(\&)(\*)(\（)(\）)(\-)(\+)(\|)(\{)(\})(\‘)]+/);return this.optional(element) || !reg.test(value);}, "Please enter a valid date.");$.validator.addMethod("isInject", function(value, element) {var reg = RegExp(/[(\> )(\<)(\/)(\')(\")]+/);return this.optional(element) || !reg.test(value.trim());}, "Please enter a valid date.");$.validator.addMethod("customvalid",function(value,element,params){try{return eval("("+params+")")}catch(e){return false}},"Please fix this field.");$.validator.addClassRules({date:{date:true},alphanumeric:{alphanumeric:true},lettersonly:{lettersonly:true},phone:{phone:true},postcode:{postcode:true}});$.validator.setDefaults({errorElement:"span"});$.validator.autoCreateRanges=true}})(jQuery);(function(A){A.extend(A.validator.messages,{required:"必填字段",remote:"请修正该字段",email:"请输入正确格式的电子邮件",url:"请输入合法的网址",date:"请输入合法的日期",dateISO:"请输入合法的日期 (ISO).",number:"请输入合法的数字",digits:"只能输入整数",creditcard:"请输入合法的信用卡号",equalTo:"请再次输入相同的值",accept:"请输入拥有合法后缀名的字符串",maxlength:A.validator.format("长度最多是 {0} 的字符串"),minlength:A.validator.format("长度最少是 {0} 的字符串"),rangelength:A.validator.format("长度介于 {0} 和 {1} 之间的字符串"),range:A.validator.format("请输入一个介于 {0} 和 {1} 之间的值"),max:A.validator.format("请输入一个最大为 {0} 的值"),min:A.validator.format("请输入一个最小为 {0} 的值"),alphanumeric:"字母、数字、下划线",lettersonly:"必须是字母",phone:"请输入合法的电话号码",isSpec: "您输入的有不合法的标点符号",isInject:"您的输入有误， 不允许输入字符  < > /  \'  \" " })})(jQuery);(function(A){A.fn.extend({checkboxCtrl:function(B){return this.each(function(){var D=A(this);var C=D.attr("group");if(!C){return false}D.iCheck({checkboxClass:"icheckbox_minimal-blue"});D.bind("ifChecked",function(F){var E="all";A.checkbox.select(C,E,B)});D.bind("ifUnchecked",function(F){var E="none";A.checkbox.select(C,E,B)})})}});A.checkbox={selectAll:function(C,B){this.select(C,"all",B)},unSelectAll:function(C,B){this.select(C,"none",B)},selectInvert:function(C,B){this.select(C,"invert",B)},select:function(D,C,B){$parent=A(B||document);$checkboxLi=$parent.find(":checkbox[name='"+D+"']");switch(C){case"invert":$checkboxLi.iCheck("toggle");break;case"none":$checkboxLi.iCheck("uncheck");break;default:$checkboxLi.iCheck("check");break}}}})(jQuery);function initUI(response){var $p=$(response||document);$(":button.checkboxCtrl, :checkbox.checkboxCtrl",$p).checkboxCtrl($p);$("a[target=hgTab], button[target=hgTab]",$p).each(function(){var $this=$(this);if(!$this.data("binded")){$(this).click(function(event){var title=$this.attr("title")||$this.text();var tabid="_blank";var url=unescape($this.attr("href"));var $curTab=$.hgtab.getCurrent();var parTabid=$curTab.data("_tabid");$.hgtab.open(url,tabid,title,parTabid);event.preventDefault();return false})}$this.data("binded",true)});$("input[type=file]",$p).each(function(){var $this=$(this);var uploadUrl=$this.attr("upload-url");var maxSize=$this.attr("max-size")||"";var maxHeight=$this.attr("max-height")||"";var maxWidth=$this.attr("max-width")||"";var imgRef=$this.attr("img-ref");var idRef=$this.attr("id-ref");$this.attr("id","_imgFile_"+HG.getRandom());$("#"+imgRef).addClass("img-polaroid");var op={maxHeight:maxHeight,maxWidth:maxWidth};new AjaxUpload($this,{action:uploadUrl,name:"file",responseType:"json",data:op,onSubmit:function(file,ext,fileSize){if(maxSize&&maxSize<fileSize){HG.messager("上传文件大小超过限制！","info");return false}if(!(ext&&/^(png|jpg|gif|jpeg|PNG|JPG|GIF|JPEG)$/.test(ext))){HG.messager("请上传图片格式文件！","info");return false}},onComplete:function(file,response,fileSize){if("success"==response.status){$("#"+imgRef).attr("src",response.imageUrl);$("#"+idRef).val(response.imageId)}else{HG.messager(response.msg,"info")}}})});$("a[target=submit]",$p).each(function(){var $this=$(this);if(!$this.data("binded")){$(this).click(function(event){var form=HG.getForm(this);form.onsubmit();event.preventDefault()})}$this.data("binded",true)});$("a[target=cancel]",$p).each(function(){$(this).click(function(event){var $curTab=$.hgtab.getCurrent();var parTabid=$curTab.data("_parTabid");$.hgtab.openByTabid(parTabid);event.preventDefault()})});$("input[type=radio][target=radio]",$p).each(function(){var $this=$(this);var $clickBack=$this.attr("data-click")||function(event){};if(!$.isFunction($clickBack)){$clickBack=eval("("+$clickBack+")")}$this.iCheck({radioClass:"iradio_minimal-blue"});$this.bind("ifClicked",$clickBack)});$("input[type=checkbox][target=checkbox]",$p).each(function(){var $this=$(this);var $clickBack=$this.attr("data-click")||function(){};if(!$.isFunction($clickBack)){$clickBack=eval("("+$clickBack+")")}$this.iCheck({checkboxClass:"icheckbox_minimal-blue"});$this.bind("ifClicked",$clickBack)});$("select[target=combobox]",$p).each(function(){var $this=$(this);var suggesturl=$this.attr("suggesturl");var dataName=$this.attr("data-name");var dataValue=$this.attr("data-value");var dataAutoLoad=$this.attr("data-auto-load")||true;var defValue=$this.attr("def-value");var wrapperClass=$this.attr("wrapperClass")||"";var dataCascadeId=$this.attr("data-cascade-id");var $dataOnchange=$this.attr("data-onchange")||function(){};if(!$.isFunction($dataOnchange)){$dataOnchange=eval("("+$dataOnchange+")")}var onChange=function(selected){if($dataOnchange){$dataOnchange(selected)}};if(dataCascadeId&&$("#"+dataCascadeId)){var $cascade=$("#"+dataCascadeId);var cascadeSuggesturl=$cascade.attr("suggesturl");onChange=function(selected){var newSuggesturl=(HG.fullProperty(cascadeSuggesturl,selected));$cascade.attr("suggesturl",newSuggesturl);$cascade.attr("data-auto-load",true);initUI($cascade.parent());if($dataOnchange){$dataOnchange(selected)}}}var bindFun=function(){var oldEasyDrop=$this.data("easyDrop");if(oldEasyDrop){oldEasyDrop.easyDropDown("destroy")}if(!$this.html().trim()){$this.html("<option>请选择</option>")}var op={cutOff:10,onChange:onChange};if(wrapperClass){op=$.extend(op,{wrapperClass:wrapperClass})}var easyDrop=$this.easyDropDown(op);$this.data("easyDrop",easyDrop)};if(suggesturl&&dataName&&dataValue&&suggesturl.isFinishedTm()&&dataAutoLoad){$.ajax({global:false,type:"POST",dataType:"json",url:suggesturl,cache:false,success:function(response){if(!response){return}var html="";$.each(response,function(i){html+='<option value="'+this[dataValue]+'"'+((this[dataValue]&&this[dataValue]==defValue)?'selected="selected"':"")+">"+this[dataName]+"</option>"});$this.html(html);bindFun()}})}else{bindFun()}});$("form.required-validate",$p).each(function(){var $form=$(this);$form.validate({onsubmit:false,focusInvalid:false,focusCleanup:false,errorElement:"span",ignore:".ignore",invalidHandler:function(form,validator){var errors=validator.numberOfInvalids();if(errors){HG.messager("提交数据不完整，"+errors+"个字段有错误，请改正后再提交!","info")}}});$form.find("input[customvalid]").each(function(){var $input=$(this);$input.rules("add",{customvalid:$input.attr("customvalid")})})});$("script[target=editor]",$p).each(function(){var thisId=$(this).attr("id");var name=$(this).attr("name")||"editorValue";var _markId=$(this).attr("markId");var _useType=$(this).attr("useType");var _imgIdRef=$(this).attr("imgId-ref");if(_markId&&_useType&&_imgIdRef){var editor=UE.getEditor(thisId,{elementPathEnabled:false,textarea:name,_markId:_markId,_useType:_useType,_imgIdRef:_imgIdRef});$p.data("editorid",thisId)}});if($.fn.ajaxTodo){$("a[target=ajaxTodo]",$p).ajaxTodo()}if($.fn.selectedTodo){$("a[target=selectedTodo]",$p).selectedTodo()}}function validateCallback(C,A,D){var B=$(C);if(!B.valid()){return false}var E=function(){$.ajax({type:C.method||"POST",url:B.attr("action"),data:B.serializeArray(),dataType:"json",cache:false,success:A||HG.ajaxDone,error:HG.ajaxError})};if(D){HG.confirm("确认",D,function(){if(E){E()}})}else{E()}return false}function hgTabAjaxDone(A){HG.ajaxDone(A);if(A.statusCode==HG.statusCode.ok){$.hgtab.openByTabid(A.navTabId)}}function ajaxTodo(url,callback){var $callback=callback||hgTabAjaxDone;if(!$.isFunction($callback)){$callback=eval("("+callback+")")}HG.block();$.ajax({type:"POST",url:url,dataType:"json",cache:false,success:function(response){HG.unblock();$callback(response)},error:HG.ajaxError})}function uploadifyError(C,B,A){HG.messager(B+": "+A,"error")}(function(A){A.hgtab={_current:null,getCurrent:function(){return this._current},open:function(C,E,F,B){var G=this;var D=A("#content");if(C){HG.block();G.destroy();A.ajax({type:"GET",url:C,cache:false,dataType:'html',success:function(H){setTimeout(function(){var J=HG.jsonEval(H);if(J.statusCode==HG.statusCode.error){if(J.message){HG.messager(J.message,"info")}}else{if(J.statusCode==HG.statusCode.timeout){HG.confirm("确认","登陆超时！请重新登陆",function(){window.location=HG.getRootPath()+"/jq/login"})}else{var I=A(H);D.html(I);I.data("_tabid",E);I.data("_url",C);I.data("_title",F);if(B){I.data("_parTabid",B)}D.prepend("<h2>"+F+"</h2>");A("body").data(E,I);A.hgtab._current=I;setTimeout(function(){initUI(D)},80)}}HG.unblock()},70)},error:HG.ajaxError})}},openByTabid:function(B){var C=A("#menu");A("a","#menu").each(function(){var D=A(this);if(D.attr("ref")==B){D.click()}})},destroy:function(){var C=A("#content");var B=A(C||document);var D=B.data("editorid");if(D){UE.delEditor(D)}},}})(jQuery);