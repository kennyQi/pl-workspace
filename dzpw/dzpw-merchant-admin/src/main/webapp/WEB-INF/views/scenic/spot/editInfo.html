<#assign contextPath=springMacroRequestContext.getContextPath() />
<#assign navTabid = navTabid!'scenic-spot' />
<#assign pathUrl = (contextPath+'/scenic-spot') />

<style>
.jq{background:#eee;font-weight:600;}
.jq span{margin-left:5px;}
	.myPageContent{
		width:650px !important;
	    border-style: solid;
	    border-width: 1px;
	    border-color: #b8d0d6;
	}
	.imgContext{
		height:250px !important;
	}
	.myUnit{
		display: inline-block;
    	margin: 7px;
	}
	.myUnit p{
		width:160px;
		float:none !important;
	}
	.myUnit p input{
		float:left;
	}
	.themeType{
		padding: 2px 4px;
		background-color: rgb(248, 226, 187);
		margin-right:5px;
	}
</style>
<link href="${contextPath}/resources/dwz-ria/uploadify/css/uploadify.css">
<script type="text/javascript" src="resources/js/MyJs.js"></script>
<div class="pageContent">
<form method="post" action="${pathUrl}/editSubmit" class="pageForm required-validate" id="editScenForm"
	onsubmit="return beforeSubmitForm(this)">
	<input type="hidden" name="navTabid" value="${navTabid!}" />
	<input type="hidden" name="scenicspotId" value="${(scen.id)!}" />
	<div class="pageFormContent" layoutH="58" id="scenicContent">
	
		<!-- 景区基本信息   -->
		<div class="jq unit" style="padding:8px 10px;margin-bottom:10px;"><span>景区基本信息</span></div>
		<div class="unit">
			<label>登录账户：</label>
			<input type="text" size="32" placeholder="登录账户名"
				minlength="4" maxlength="20" value="${(scen.superAdmin.adminLoginName)!'-'}" readonly="true"/>
		</div>
		
		<div class="unit">
			<label>景区全称：</label>
			<input type="text" size="32" readonly="true" placeholder="景区名称" maxlength="64" value="${(scen.baseInfo.name)!'-'}"/>
		</div>
		
		<div class="unit">
			<label>景区简称：</label>
			<input type="text" readonly="true" size="32" placeholder="景区简称" maxlength="64" value="${(scen.baseInfo.shortName)!'-'}"/>
		</div>
		<div>
			<label>景区别名：</label>
			<input type="text" readonly="true" size="32" value="${(scen.baseInfo.aliasName)!''}"/>
		</div>
		<div class="unit">
			<label>景区密钥：</label>
			<input type="text" readonly="true" size="64" placeholder="景区密钥" maxlength="64" value="${(scen.superAdmin.secretKey)!''}"></input>
		</div>
		<div class="unit">
			<label>景区质量等级：</label>
			<input type="text"  size="32" readonly="true"  placeholder="景区质量等级" maxlength="64" value="${(scen.baseInfo.level)!''}"/>
		</div>
		<div class="unit">
			<label>建筑部等级：</label>
			<input type="text"  size="32"  readonly="true"  placeholder="景区建筑部等级" maxlength="64" value="${(scen.baseInfo.buildLevel)!''}"/>
		</div>
		<div class="unit">
			<label>主题类型：</label>
			<select name="themeValue" onchange="validTheme()">
				<option vlue="">请选择</option>
				<#list scenThemeType?keys as key>
					<option value="${key}" <#if scen.baseInfo.themeValue??><#if (scen.baseInfo.themeValue?size>0)&&(scen.baseInfo.themeValue[0]==key)>selected</#if></#if> >${scenThemeType[key]}</option>
				</#list>
			</select>
			<select name="themeValue" onchange="validTheme()">
				<option vlue="">请选择</option>
				<#list scenThemeType?keys as key>
					<option value="${key}" <#if scen.baseInfo.themeValue??><#if (scen.baseInfo.themeValue?size>1)&&(scen.baseInfo.themeValue[1]==key)>selected</#if></#if> >${scenThemeType[key]}</option>
				</#list>
			</select>
			<select name="themeValue" onchange="validTheme()">
				<option vlue="">请选择</option>
				<#list scenThemeType?keys as key>
					<option value="${key}" <#if scen.baseInfo.themeValue??><#if (scen.baseInfo.themeValue?size>2)&&(scen.baseInfo.themeValue[2]==key)>selected</#if></#if> >${scenThemeType[key]}</option>
				</#list>
			</select>
			<div style="padding-top:5px;corlor:orange;">&nbsp;&nbsp;至少选择一个分类</div>
		</div>
		<div class="unit">
			<label>景区特色：</label>
			<input type="text" name="feature" size="64" maxlength="32" class="required" value="${(scen.baseInfo.feature)!''}"/>
			<div style="padding-top:5px;corlor:orange;">&nbsp;&nbsp;最多32个字符</div>
		</div> 
		<div class="unit">
			<label>开放时间：</label>
			<input type="text" name="openTime" size="64" class="required" maxlength="32" value="${(scen.baseInfo.openTime)!''}"/>
			<div style="padding-top:5px;corlor:orange;">&nbsp;&nbsp;最多32个字符</div>
		</div> 
		<div class="unit">
			<label>百度经度：</label>
			<input name="longitude" type="text" size="64" value="${(scen.contactInfo.longitude)!''}"/>
		</div>
		<div class="unit">
			<label>百度纬度：</label>
			<input name="latitude" type="text" size="64" value="${(scen.contactInfo.latitude)!''}"/>
		</div>
		<div class="unit">
			<label>景区网址：</label>
			<input type="url" name="webSite" size="64" placeholder="输入带有HTTP前缀的地址" maxlength="1024" value="${(scen.baseInfo.webSite)!'-'}"/>
		</div>
		<div class="unit">
			<label>景区地址：</label>
			<select id="provinceId" name="provinceId" onchange="findPCA($('#provinceId', $.pdialog.getCurrent()).val(), '')">
				<option value="">请选择</option>
			<#list provinceList as pr>
				<option value="${pr.id}"<#if pr.id==scen.baseInfo.province.id>selected='selected'</#if> >${pr.name}</option>
			</#list>
			</select>
			<select id="cityId" name="cityId" onchange="findPCA('', $('#cityId', $.pdialog.getCurrent()).val())">
				<option value="">请选择</option>
			<#list cityList as ct>
				<option value="${scen.baseInfo.city.id}" <#if ct.id==scen.baseInfo.city.id>selected='selected'</#if> >${ct.name}</option>
			</#list>
			</select>
			<select id="areaId" name="areaId">
				<option value="">请选择</option>
			<#list areaList as ar>
				<option value="${scen.baseInfo.area.id}" <#if ar.id==scen.baseInfo.area.id>selected='selected'</#if> >${ar.name}</option>
			</#list>
			</select>
		</div>
		<div class="unit">
			<label>&nbsp;</label>
			<textarea id="street" name="street" class="required" rows="5" cols="50" placeholder="详细地址">${scen.baseInfo.street}</textarea>
		</div>
		<div class="unit">
			<label>景区简介：</label>
			<textarea class="editor required" name="intro" rows="10" cols="90" 
			tools="Fullscreen,Source,|,SelectAll,Cut,Copy,Pastetext,Blocktag,|,Fontface,FontSize,Bold,
			Italic,Underline,Strikethrough,FontColor,BackColor,|,Removeformat,Align,List,Outdent,Indent,
			Link,Unlink,Hr,Table">${(scen.baseInfo.intro)!'-'}
			</textarea>
		</div>
		<div class="unit">
			<label>交通指南：</label>
			<textarea class="editor required" name="traffic" rows="10" cols="90" 
			tools="Fullscreen,Source,|,SelectAll,Cut,Copy,Pastetext,Blocktag,|,Fontface,FontSize,Bold,
			Italic,Underline,Strikethrough,FontColor,BackColor,|,Removeformat,Align,List,Outdent,Indent,
			Link,Unlink,Hr,Table">${(scen.contactInfo.traffic)!'-'}
			</textarea>
		</div>
		<div class="unit">
			<label>预定须知：</label>
			<textarea name="preNotice" class="editor required" rows="10" cols="90" 
			tools="Fullscreen,Source,|,SelectAll,Cut,Copy,Pastetext,Blocktag,|,Fontface,FontSize,Bold,
			Italic,Underline,Strikethrough,FontColor,BackColor,|,Removeformat,Align,List,Outdent,Indent,
			Link,Unlink,Hr,Table">${(scen.baseInfo.preNotice)!''}</textarea>
		</div>
		<div class="unit">
			<label>企业logo：</label>
			<span class="u-upload">
				<input class="upFile" id="file_logo" type="file" name="file" data-msg="企业LOGO" data-imgun="imgun_logo" size="60" onchange="imgUpload(this);"/>
            </span>
		</div>
		<div class="unit" id="imgun_logo">
			<label>&nbsp;</label>
			<img class="img-polaroid" width="80" alt="企业logo" title="企业logo"
				src="${(scen.certificateInfo.scenicSpotLogo)!'resources/image/u39.png'}"/>
          	<!-- <input name="titles" type="hidden"/>
          	<input name="fileNames" type="hidden"/> -->
          	<input name="imgNames" type="hidden"/>
          	<input name="imgSrcs" type="hidden" value="${(scen.certificateInfo.scenicSpotLogo)}"/>
		</div>
		<div class="unit">
			<label>景区图片：</label>
			<div class="pageContent myPageContent" style="width:760px;">
				<div class="panelBar">
					<ul class="toolBar">
						<li>
							<a class="delete" href="#" onclick="delImage();">
								<span>批量删除</span>
							</a>
						</li>
					</ul>
				</div>
				<div class="imgContext" layoutH="700">
					<!-- 景区图片，js动态生成 -->
					<#list scen.pics as pic>
					<div class="myUnit">
						<img class="img-polaroid" width="160" height="120" alt="${(pic.name)!''}" title="${(pic.name)!''}" src="${(pic.url)!''}">
						<p style="height:25px;line-height:20px;">
							<input class="checkboxCtrl" type="checkbox" name="pictureIds" value="0">
							<label class="myLabel">${(pic.name)!''}</label>
						</p>
						<div class="imgIdContext">
							<input name="scenPicIds" type="hidden" value="${pic.id}"/>
							<input name="scenPicFlags" type="hidden" value=""/>
							<input name="scenPicNames" type="hidden" value="${(pic.name)!''}"/>
							<input name="scenPicUrls" type="hidden" value="${(pic.url)!''}"/>
						</div>
					</div>
					</#list>
				</div>
				<div class="panelBar hover">
					<div class="pages" style="float:right;">
						<span>
							<button type="button" class="checkboxCtrl" group="pictureIds">全选</button>
						</span>
						<span>
							<button type="button" class="checkboxCtrl" group="pictureIds" selectType="invert">反选</button>
						</span>
					</div>
				</div>
			</div>
		</div>
		<div class="unit">
			<label>&nbsp;</label>
			<div class="myPageContent pageContent">
		<!-- 	<form> -->
				<!-- <input type="hidden" name="scenicSpotId" value="${scenicSpotId}"/> -->
				<div class="pageFormContent" style="background:#EAF1FD;">
					<label class="myPageLabel">上传图片</label>
					<div class="unit">
						<span class="u-upload">
							<input type="file" name="fileName" id="file_upload"/>
						</span>
						<span style="color:gray;">请上传JPG/PNG/GIF/BMP格式的图片，最大不超过2M</span>
						<span id="hiddContent"></span>
					</div>
				</div>
		<!-- 	</form> -->
			</div>
		</div>
		<!-- 资质信息  -->
		<div class="jq unit" style="padding:8px 10px;margin-top:20px;margin-bottom:10px;"><span>资质信息</span></div>
		<div class="unit">
			<label>营业执照：</label>
			<span class="u-upload">
				<input class="upFile" id="file1" type="file" name="file" data-msg="营业执照" data-imgun="imgun1" size="60" onchange="imgUpload(this);"/>
            </span>
		</div>
		<div class="unit" id="imgun1">
			<label>&nbsp;</label>
			<img class="img-polaroid" width="80" alt="营业执照" title="营业执照"
				src="${(scen.certificateInfo.businessLicense)!'resources/image/u39.png'}"/>
          	<!-- <input name="titles" type="hidden"/>
          	<input name="fileNames" type="hidden"/> -->
          	<input name="imgNames" type="hidden"/>
          	<input name="imgSrcs" type="hidden" value="${(scen.certificateInfo.businessLicense)}"/>
		</div>
		
		<div class="unit">
			<label>税务登记证：</label>
			<span class="u-upload">
				<input class="upFile" id="file2" type="file" name="file" data-msg="税务登记证" data-imgun="imgun2" size="60" onchange="imgUpload(this);"/>
            </span>
		</div>
		<div class="unit" id="imgun2">
			<label>&nbsp;</label>
			<img class="img-polaroid" width="80" alt="税务登记证" title="税务登记证"
				src="${(scen.certificateInfo.taxRegistrationCertificate)!'resources/image/u39.png'}"/>
          	<!-- <input name="titles" type="hidden"/>
          	<input name="fileNames" type="hidden"/> -->
          	<input name="imgNames" type="hidden"/>
          	<input name="imgSrcs" type="hidden" value="${(scen.certificateInfo.taxRegistrationCertificate)}"/>
		</div>
		<div class="unit">
			<label>组织代码证：</label>
			<span class="u-upload">
				<input class="upFile" id="file3" type="file" name="file" data-msg="组织代码证" data-imgun="imgun3" size="60" onchange="imgUpload(this);"/>
            </span>
		</div>
		<div class="unit" id="imgun3">
			<label>&nbsp;</label>
			<img class="img-polaroid" width="80" alt="组织代码证" title="组织代码证"
				src="${(scen.certificateInfo.organizationCodeCertificate)!'resources/image/u39.png'}"/>
          	<!-- <input name="titles" type="hidden"/>
          	<input name="fileNames" type="hidden"/> -->
          	<input name="imgNames" type="hidden"/>
          	<input name="imgSrcs" type="hidden" value="${(scen.certificateInfo.organizationCodeCertificate)}"/>
		</div>
		<div class="unit">
			<label>法人身份证：</label>
			<span class="u-upload">
				<input class="upFile" id="file4" type="file" name="file" data-msg="法人身份证" data-imgun="imgun4" size="60" onchange="imgUpload(this);"/>
            </span>
		</div>
		<div class="unit" id="imgun4">
			<label>&nbsp;</label>
			<img class="img-polaroid" width="80" alt="法人身份证" title="法人身份证"
				src="${(scen.certificateInfo.corporateIDCard)!'resources/image/u39.png'}"/>
          	<!-- <input name="titles" type="hidden"/>
          	<input name="fileNames" type="hidden"/> -->
          	<input name="imgNames" type="hidden"/>
          	<input name="imgSrcs" type="hidden" value="${(scen.certificateInfo.corporateIDCard)}"/>
		</div>
		<!-- 景区联系信息   -->
		<div class="jq unit" style="padding:8px 10px;margin-top:20px;margin-bottom:10px;"><span>景区联系信息</span></div>
		<div class="unit">
			<label>联&nbsp;&nbsp;系&nbsp;&nbsp;人：</label>
			<input type="text" name="linkMan" size="64" class="isSpec required" placeholder="联系人" maxlength="64" value="${(scen.contactInfo.linkMan)!'-'}"/>
		</div>
		<div class="unit">
			<label>&nbsp;&nbsp;职&nbsp;&nbsp;位&nbsp;&nbsp;：</label>
			<input type="text" name="job" size="64" class="isSpec required" placeholder="联系人职位" maxlength="64" value="${(scen.contactInfo.job)!'-'}"/>
		</div>
		<div class="unit">
			<label>联系电话：</label>
			<input type="tel" name="telephone" size="64" class="isInject required phone" placeholder="联系电话" maxlength="12" value="${(scen.contactInfo.telephone)!'-'}"/>
		</div>
		<div class="unit">
			<label>联系邮箱：</label>
			<input type="email" name="email" size="64" class="isInject required" placeholder="邮箱地址" maxlength="64" value="${(scen.contactInfo.email)!'-'}"/>
		</div>
		
		<div class="jq unit" style="padding:8px 10px;margin-top:20px;margin-bottom:10px;"><span>景区结算信息</span></div>
		<div class="unit">
			<label>开&nbsp;&nbsp;户&nbsp;&nbsp;行：</label>
			<select name="depositBank" class="combox">
				<option value="">未选择</option>
				<option value="中国银行" <#if scen.settleInfo.depositBank=='中国银行'>selected</#if> >中国银行</option>
				<option value="农业银行" <#if scen.settleInfo.depositBank=='农业银行'>selected</#if>>农业银行</option>
				<option value="建设银行" <#if scen.settleInfo.depositBank=='建设银行'>selected</#if>>建设银行</option>
				<option value="工商银行" <#if scen.settleInfo.depositBank=='工商银行'>selected</#if>>工商银行</option>
			</select>
		</div>
		<div class="unit">
			<label>开户单位：</label>
			<input type="text" name="depositOrg" readonly="true" size="32" value="${(scen.settleInfo.depositOrg)!''}"/>
		</div>
		<div class="unit">
			<label>&nbsp;&nbsp;帐&nbsp;&nbsp;号&nbsp;&nbsp;：</label>
			<input type="text" name="depositAccount" size="32" readonly="true" value="${(scen.settleInfo.depositAccount)!''}"/>
		</div>
		<div class="unit">
			<label>手续费率：</label>
			<input  class="required number" name="settlementFee" size="12" max="1000" value="${((scen.settleInfo.settlementFee)?c)!''}"/> 元/人次
		</div>
		
		<!-- 设备信息  -->
<#--		<div class="jq unit" style="padding:8px 10px;margin-top:20px;margin-bottom:10px;"><span>设备信息</span></div>
		<table class="table" width="70%" layoutH="170">
				<thead>
					<tr>
						<th width="10%">序号</th>
						<th width="10%">登录账户</th>
						<th width="5%" >设备编码</th>
					</tr>
			    </thead>
			    <tbody>
					<#list scen.devices as devic>
					<tr>
						<td>${(devic_index+1)}</td>
						<td>${(scen.superAdmin.adminLoginName)!'-'}</td>
						<td>${(devic.id)!'-'}</td>
					</tr>
					</#list>
				</tbody>
		</table>
-->
	</div>

	<div class="formBar">
		<ul>
			<li>
				<div class="buttonActive"><div class="buttonContent">
					<button type="submit" style="width: 35px;">保存</button>
				</div></div>
			</li>
			<li>
				<div class="button">
					<div class="buttonContent">
						<button type="button" onclick="MyClose('是否取消修改该景区？','monitorDiag')"  style="width: 35px;">取消</button>
					</div>
				</div>
			</li>
		</ul>
	</div>
</form>
</div>
<script type="text/javascript" src="${contextPath}/resources/js/kindeditor/kindeditor-min.js"></script>
<script type="text/javascript" src="${contextPath}/resources/js/kindeditor/lang/zh_CN.js"></script>
<script type="text/javascript">
var beforeSubmitForm = function(evt){
	if($("#imgun_logo").find("img").attr("src")==""){
		alertMsg.error("企业logo不能为空");
		return false;
	}
	if($("#imgun1").find("img").attr("src")==""){
		alertMsg.error("营业执照不能为空");
		return false;
	}
	if($("#imgun2").find("img").attr("src")==""){
		alertMsg.error("税务登记证不能为空");
		return false;
	}
	if($("#imgun3").find("img").attr("src")==""){
		alertMsg.error("组织代码证不能为空");
		return false;
	}
	if($("#imgun4").find("img").attr("src")==""){
		alertMsg.error("法人身份证不能为空");
		return false;
	}
	var themeValue=$("select[name='themeValue']");
	var themeValueSize=0;
	numReg=/^[0-9]*$/;
	$.each(themeValue,function (i,e) { 
		  if (numReg.test(e.value)) { 
			  themeValueSize++;
		  } 
		});
	if(themeValueSize<1){
		alertMsg.error("至少选择一个主题类型");
		return false;
	}
	if(scenpicValid()<1){
		alertMsg.error("景区图片不能为空！");
		return false;
	}
	if(scenpicValid()<1){
		alertMsg.error("景区图片不能为空！");
		return false;
	}
	//调用DWZ的校验
	return validateCallback(evt,dialogAjaxDone);
}
//验证景区图片
function scenpicValid(){
	var imgs=$(".myUnit:visible").find("img");
	//console.info(imgs.size());
	return imgs.size();
	
}

	/** 省级输入框单击事件 */
	$('input[name="province.name"]').click(function() {
		$('input[name="city.name"]').val('');
		$('input[name="city.code"]').val('');
	});
	
	/**市区输入框单击事件 */
	$('input[name="city.name"]').click(function() {
		$('input[name="area.name"]').val('');
		$('input[name="area.code"]').val('');
	});
	
	/**表单提交之前进行校验*/
	function fromHand(){
		//alert(123);
	    /**省市地区取值*/
		var provinceId = $("#provinceQoCode").val();
		var cityId = $("#cityQoCode").val();
		var areaId = $("#areaQoCode").val();
		//alert(provinceId+cityId+areaId);
		 /**省市地区赋值*/
		$("#provinceId").val(provinceId);
		$("#cityId").val(cityId);
		$("#areaId").val(areaId); 
	}
	
	function MyClose(msg,formId){
		var tempFun = function(){
			navTab.closeCurrentTab();
		};
		alertMsg.confirm(msg,{okCall: tempFun});
	}
	
	//判断是否有重复主题
	function validTheme(){
		var themeValues=$("select[name='themeValue']");
		var empty="请选择";
		//console.info(themeValues.eq(0).val());
		//console.info(themeValues.eq(1).val());
		//console.info(themeValues.eq(2).val());
		if((themeValues.eq(0).val()!=empty)&&(themeValues.eq(1).val()!=empty)&&themeValues.eq(0).val()==themeValues.eq(1).val()){
			alertMsg.error("景区主题重复");
			return 0;
		}
		else if((themeValues.eq(2).val()!=empty)&&(themeValues.eq(1).val()!=empty)&&themeValues.eq(2).val()==themeValues.eq(1).val()){
			alertMsg.error("景区主题重复");
			return 0;	
		}
		else if((themeValues.eq(0).val()!=empty)&&(themeValues.eq(2).val()!=empty)&&themeValues.eq(2).val()==themeValues.eq(0).val()){
			alertMsg.error("景区主题重复");
			return 0;
		}
		return 1;
	}
	/**修改省市区*/
	function findPCA(pid, cid){
		var ps;
		if(pid!="" && cid==""){
			ps = '${contextPath}'+"/baseDate/city?provinceCode="+pid;
		}
		if(pid=="" && cid!=""){
			ps = '${contextPath}'+"/baseDate/area?cityCode="+cid;
		}
		
		$.ajax({
			type:"post",
			url: ps,
			cache: false,
			dataType: "json",
			success: function(data){
				var html = "";
				$.each(data, function(i, n){
					html = html + "<option value=\""+n["id"]+"\">"+n["name"]+"</option>";
				});
				
				//修改省时
				if(pid!="" && cid==""){
					//重置市选项
					html = "<option value=\"\">请选择所在市</option>"+html;
					$("#cityId option").remove();
					$("#cityId").append(html);
					//重置区选项
					$("#areaId option").remove();
					$("#areaId").append("<option value=\"\">请选择所在区</option>");
				}
				//修改市时
				if(pid=="" && cid!=""){
					//重置区选项
					html = "<option value=\"\">请选择所在区</option>"+html;
					$("#areaId option").remove();
					$("#areaId").append(html);
				}
			}
		});
	}

	/** 图片上传按钮单击事件 */
	function imgUpload(evt){
		var temp = $(evt);
		var groupURL = '/group0/';
		//获取后缀，并校验
		var vall = temp.val();
		var fileName = vall.substr(vall.lastIndexOf("\\")+1);
		var ext = vall.substr(vall.lastIndexOf(".")+1);
		if(!(ext && /^(jpg|jpeg|png|gif)$/.test(ext.toLowerCase()))){
			alertMsg.warn("暂不支持jpg、gif、png、bmp以外的图片！");
			return false;
		}
		//发起请求
		$.ajaxFileUpload({
			url : '${contextPath}/imgUpload',
	       	secureuri : false,
	       	fileElementId : temp.attr("id"),
	       	dataType : "json",
	      	success: function (da) {
	        	if(da.rs < 1){
	        		alertMsg.warn("图片上传失败："+da.msg);
					return false;
	        	}
	        	
	        	//图片显示
	        	var chs = $("#"+temp.data("imgun"));
	        	chs.find("img").attr("src",groupURL+da.imgName);
	        	//chs.find("input:eq(0)").val(temp.data("msg"));
	        	//chs.find("input:eq(0)").val(da.imgName);
	        	chs.find("input:eq(0)").val(da.imgName);
	        },
	        error: function (data, status, e) {
	        	alertMsg.warn("图片上传失败，请稍后重试！");
	        }
	    });
	}

	//注册汇金宝账户
	function regHJB(){
		if($("#cstNo").val()!="" && $("#operatorNo").val!=""){
			alertMsg.warn("您已注册过，不允许重复注册！");
			return;
		}
		var province=$("#editScenForm").find("#provinceId").val()==""?"":$("#editScenForm").find(("#provinceId option:selected")).text()+"省";
		var city=$("#editScenForm").find("#cityId").val()==""?"":$("#editScenForm").find(("#cityId option:selected")).text()+"市";
		var area=$("#editScenForm").find("#areaId").val()==""?"":$("#editScenForm").find(("#areaId option:selected")).text();
		var street=$("#editScenForm").find("#street").val() || "";
		var address=province+city+area+street;
		
		var linkMan=$("#editScenForm").find("input[name='linkMan']").val() || "";
		var telephone=$("#editScenForm").find("input[name='telephone']").val() || "";
		var email=$("#editScenForm").find("input[name='email']").val() || ""
		var cstName=$("#editScenForm").find("input[name='name']").val() || "";
		
		console.info("address:"+address);
		console.info("linkMan:"+linkMan);
		console.info("telephone:"+telephone);
		console.info("email:"+email);
		var regHref="${contextPath}/hjbreg/addAccount";
		console.info(regHref);
		regHref+="?seril="+getRandomString();
		console.info("regH="+regHref);
		if(address!=""){
			regHref+="&address="+address;
			console.info(regHref);
		}
		if(linkMan!=""){
			regHref+="&linkMan="+linkMan;
		}
		if(telephone!=""){
			regHref+="&telephone="+telephone;
		}
		if(email!=""){
			regHref+="&email="+email;
		}
		if(cstName!=""){
			regHref+="&cstName="+cstName;
		}
		console.info("href:"+regHref);
		$("#acc_reg").attr("href",regHref);
		$("#acc_reg").click();
	}
	//获取长度为len的随机字符串  
	function getRandomString(len) {
	    len = len || 16;  
	    var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678'; // 默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1  
	    var maxPos = $chars.length;  
	    var pwd = '';  
	    for (i = 0; i < len; i++) {  
	        pwd += $chars.charAt(Math.floor(Math.random() * maxPos));  
	    }  
	    return pwd;  
	}
	/**
	 *景区图片管理
	 */

		var headHtml = '<li class="selected" onclick="getTabsIndex(this);"><a href="#"><span>$name</span></a></li>';
		var imgHtml = '<div class="myUnit"><img class="img-polaroid" width="160" height="120" alt="$scenPicName" title="$scenPicName" src="$uri"/>'+
			'<p style="height:25px;line-height:20px;"><input class="checkboxCtrl" type="checkbox" name="pictureIds" class="myInput" value="0"/>'+
			'<label class="myLabel">$scenPicName</label></p><div class="imgIdContext"><input name="scenPicNames" type="hidden" value="$scenPicName"/><input name="'+
			'scenPicUrls" type="hidden" value="$scenPicUrl"/><input name="scenPicFlags" type="hidden" value="$scenPicFlag"/><input name="scenPicIds" type="hidden" value=""/></div></div>';
		var divHtml = '<div class="pageContent" style="width:600px;"><div class="panelBar"><ul class="toolBar"><li>'+
			'<a class="delete" href="#" onclick="delImage();"><span>批量删除</span></a></li></ul></div><div class="imgContext" layoutH="145">'+
			'</div><div class="panelBar hover"><div class="pages" style="float:right;"'+
			'><span><button type="button" class="checkboxCtrl" group="pictureIds">全选</button></span><span><button type="button" class="'+
			'checkboxCtrl" group="pictureIds" selectType="invert">反选</button></span></div></div></div>';

		$(function() {
			//渲染编辑器
			initKindEditor();
			$("#file_upload").uploadify({
		         'method'   : 'post',  
		         'buttonText' : '请选择',  
		         'swf'         : '${contextPath}/resources/dwz-ria/uploadify/scripts/uploadify.swf',
		 		 'uploader'      : '${contextPath}/scenicPic/upload',
		         'fileObjName'   : 'imgFile', 
		         'onUploadSuccess' : function(file, data, response) {
		        	var img=$.parseJSON(data);
		        	console.debug(img);
		            var imgContext = $(".imgContext");
			        if(undefined != imgContext){
			        		imgContext.append(
			        				imgHtml.replace(/\$scenPicName/g,img.fileName)
			        				.replace(/\$scenPicUrl/g, img.url)
			        				.replace(/\$scenPicFlag/g,"+")
			        				.replace(/\$uri/g,img.url)
			        			);
			        }
		         }  
		     });  
		});	
		
		function initKindEditor() {
			var editor;
			editor = KindEditor.create('#article_add_editor', {
				basePath : '${contextPath}/resources/js/kindeditor/',
				items : [ 'source', '|', 'undo', 'redo', '|', 'preview',
						'template', 'code', 'cut', 'copy', 'paste',
						'plainpaste', 'wordpaste', '|', 'justifyleft',
						'justifycenter', 'justifyright', 'justifyfull',
						'insertorderedlist', 'insertunorderedlist', 'indent',
						'outdent', 'subscript', 'superscript', 'clearhtml',
						'quickformat', 'selectall', '|', 'fullscreen', '/',
						'formatblock', 'fontname', 'fontsize', '|',
						'forecolor', 'hilitecolor', 'bold', 'italic',
						'underline', 'strikethrough', 'lineheight',
						'removeformat', '|', 'image', 'table', 'hr',
						'emoticons', 'baidumap', 'pagebreak', 'anchor', 'link',
						'unlink', '|' ],
				uploadJson : '${contextPath}/image/upload',
				afterChange : function() {
					this.sync();
				}
			});
		}
		

		/** 图片删除按钮单击事件 */
		function delImage(){
			var checks = $(".myUnit:visible").find("input:checked");
	    	if(checks.length < 1){
	    		alertMsg.warn("请选择图片！");
	    		return;
	    	}
	    	
	    	//函数变量
			var formFun = function(){
	    		var tempDiv = null;
	    		var tempUrl = null;
				for(var i = 0,len = checks.length;i < len;i++){
					tempDiv = $(checks[i]).parent().parent();
					tempUrl = tempDiv.find("img").attr("src");
					var picId = tempDiv.find("input[name='scenPicId']");
					//console.info("picId:" + picId);
					//console.info("tempUrl:"+tempUrl);
					if(typeof(picId) == "undefined"){
						console.info("新增图片");
						//新增的图片
						$.ajax({ 
							url: "${contextPath}/scenicPic/deleteRemotePic", 
							data:"picUrl="+tempUrl,
							type:"POST",
							success: function(){
								tempDiv.remove();
							}});
						
					}else{
						console.info("原有图片");
						//原有的图片
						//设置删除标记
						tempDiv.find("input[name='scenPicFlags']").val("-");
						tempDiv.hide();
					}
				}
			}
			//确定框
			alertMsg.confirm("确定要删除图片？",{okCall: formFun});
		}
</script>